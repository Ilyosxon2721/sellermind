window.SmCache=new class{constructor(){this.dbName="sellermind_cache",this.dbVersion=1,this.db=null,this.stores={dashboard:{keyPath:"id",ttl:3e5},products:{keyPath:"id",ttl:18e5},orders:{keyPath:"id",ttl:3e5},balance:{keyPath:"sku_id",ttl:3e5},categories:{keyPath:"id",ttl:864e5},warehouses:{keyPath:"id",ttl:36e5}}}async init(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e(this.db)},s.onupgradeneeded=e=>{const t=e.target.result;Object.keys(this.stores).forEach(e=>{if(!t.objectStoreNames.contains(e)){t.createObjectStore(e,{keyPath:this.stores[e].keyPath}).createIndex("timestamp","timestamp",{unique:!1})}})}})}async get(e,t){return await this.ensureDb(),new Promise((s,r)=>{const o=this.db.transaction([e],"readonly").objectStore(e).get(t);o.onerror=()=>r(o.error),o.onsuccess=()=>{const r=o.result;if(!r)return void s(null);const n=this.stores[e]?.ttl||3e5;Date.now()-r.timestamp>n?(this.delete(e,t),s(null)):s(r.data)}})}async set(e,t,s){return await this.ensureDb(),new Promise((r,o)=>{const n=this.db.transaction([e],"readwrite").objectStore(e),a={[this.stores[e].keyPath]:t,data:s,timestamp:Date.now()},i=n.put(a);i.onerror=()=>o(i.error),i.onsuccess=()=>r(!0)})}async getAll(e){return await this.ensureDb(),new Promise((t,s)=>{const r=this.db.transaction([e],"readonly").objectStore(e).getAll();r.onerror=()=>s(r.error),r.onsuccess=()=>{const s=this.stores[e]?.ttl||3e5,o=Date.now(),n=r.result.filter(e=>o-e.timestamp<=s).map(e=>e.data);t(n)}})}async delete(e,t){return await this.ensureDb(),new Promise((s,r)=>{const o=this.db.transaction([e],"readwrite").objectStore(e).delete(t);o.onerror=()=>r(o.error),o.onsuccess=()=>s(!0)})}async clear(e){return await this.ensureDb(),new Promise((t,s)=>{const r=this.db.transaction([e],"readwrite").objectStore(e).clear();r.onerror=()=>s(r.error),r.onsuccess=()=>t(!0)})}async ensureDb(){this.db||await this.init()}};
