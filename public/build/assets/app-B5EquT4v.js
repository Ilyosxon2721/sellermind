import{a as t}from"./vendor-Dos3PyFQ.js";import{m as n,a as e}from"./alpine-w3y3or6b.js";window.axios=t,window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";let i=null,a=null,s=!1;const o=new Set,r=new Set;let c=0;window.subscribeToChannel=function(t){return r.add(t),!(!i||i.readyState!==WebSocket.OPEN)&&(o.has(t)||(i.send(JSON.stringify({event:"pusher:subscribe",data:{channel:t}})),o.add(t)),!0)},window.unsubscribeFromChannel=function(t){r.delete(t),i&&i.readyState===WebSocket.OPEN&&(i.send(JSON.stringify({event:"pusher:unsubscribe",data:{channel:t}})),o.delete(t))},window.getWebSocketState=function(){return{connected:s,socketId:a,connection:i,reconnectAttempts:c}},window.reconnectWebSocket=function(){i&&i.close(),c=0};window.pollingManager=new class{constructor(){this.intervals=new Map,this.callbacks=new Map,this.lastCheckTimes=new Map,this.isActive=!0,this.config=window.pollingConfig||{}}start(t,n,e,i=15e3){this.intervals.has(t)&&this.stop(t),this.callbacks.set(t,e),this.lastCheckTimes.set(t,(new Date).toISOString());const a=async()=>{if(this.isActive)try{const i=n.includes("?")?"&":"?",a=`${n}${i}last_check=${this.lastCheckTimes.get(t)}`,s=await fetch(a,{headers:{Authorization:`Bearer ${this.getToken()}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!s.ok){if(401===s.status)return void this.stop(t);throw new Error(`HTTP ${s.status}: ${s.statusText}`)}const o=await s.json();o.timestamp&&this.lastCheckTimes.set(t,o.timestamp),e&&"function"==typeof e&&e(o)}catch(i){}};a();const s=setInterval(a,i);this.intervals.set(t,s)}stop(t){this.intervals.has(t)&&(clearInterval(this.intervals.get(t)),this.intervals.delete(t),this.callbacks.delete(t),this.lastCheckTimes.delete(t))}stopAll(){this.intervals.forEach((t,n)=>{clearInterval(t)}),this.intervals.clear(),this.callbacks.clear(),this.lastCheckTimes.clear()}pause(){this.isActive=!1}resume(){this.isActive=!0,this.intervals.forEach((t,n)=>{this.callbacks.get(n)&&setTimeout(()=>{},100)})}getStats(){return{active_count:this.intervals.size,is_active:this.isActive,keys:Array.from(this.intervals.keys())}}isRunning(t){return this.intervals.has(t)}getToken(){const t=localStorage.getItem("auth_token");if(t)return t;const n=document.querySelector('meta[name="csrf-token"]');return n?n.content:window.authToken?window.authToken:""}},document.addEventListener("visibilitychange",()=>{document.hidden?window.pollingManager.pause():window.pollingManager.resume()}),window.addEventListener("beforeunload",()=>{window.pollingManager.stopAll()});const l=new class{constructor(){this.isSupported="vibrate"in navigator,this.isEnabled=!0;const t=localStorage.getItem("haptic_enabled");null!==t&&(this.isEnabled="true"===t)}enable(){this.isEnabled=!0,localStorage.setItem("haptic_enabled","true")}disable(){this.isEnabled=!1,localStorage.setItem("haptic_enabled","false")}toggle(){return this.isEnabled?this.disable():this.enable(),this.isEnabled}canVibrate(){return this.isSupported&&this.isEnabled}light(){this.canVibrate()&&navigator.vibrate(10)}medium(){this.canVibrate()&&navigator.vibrate(20)}heavy(){this.canVibrate()&&navigator.vibrate(40)}success(){this.canVibrate()&&navigator.vibrate([10,50,10])}error(){this.canVibrate()&&navigator.vibrate([30,50,30,50,30])}notification(){this.canVibrate()&&navigator.vibrate([15,30,15])}selection(){this.canVibrate()&&navigator.vibrate(5)}impact(){this.canVibrate()&&navigator.vibrate(25)}custom(t){this.canVibrate()&&navigator.vibrate(t)}};window.haptic=l,window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.magic("haptic",()=>l)}),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",t=>{const n=t.target.closest("[data-haptic]");if(!n)return;switch(n.dataset.haptic||"light"){case"light":default:l.light();break;case"medium":l.medium();break;case"heavy":l.heavy();break;case"success":l.success();break;case"error":l.error();break;case"selection":l.selection();break;case"impact":l.impact()}}),l.isSupported});class d{constructor(t,n={}){this.element=t,this.options={threshold:80,maxDistance:120,resistance:2.5,onRefresh:n.onRefresh||(()=>Promise.resolve()),enabled:!0,...n},this.touchStartY=0,this.touchCurrentY=0,this.pulling=!1,this.refreshing=!1,this.distance=0,this.createIndicator(),this.attachListeners()}createIndicator(){this.indicator=document.createElement("div"),this.indicator.className="pull-to-refresh-indicator",this.indicator.innerHTML='\n            <div class="pull-to-refresh-content">\n                <div class="pull-to-refresh-spinner">\n                    <svg class="animate-spin h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24">\n                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n                    </svg>\n                </div>\n                <div class="pull-to-refresh-arrow">\n                    <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>\n                    </svg>\n                </div>\n                <div class="pull-to-refresh-text text-sm font-medium text-gray-600"></div>\n            </div>\n        ',this.element.parentNode.insertBefore(this.indicator,this.element),this.spinner=this.indicator.querySelector(".pull-to-refresh-spinner"),this.arrow=this.indicator.querySelector(".pull-to-refresh-arrow"),this.text=this.indicator.querySelector(".pull-to-refresh-text")}attachListeners(){this.element.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.element.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.element.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0})}onTouchStart(t){this.options.enabled&&!this.refreshing&&(this.element.scrollTop>0||(this.touchStartY=t.touches[0].clientY,this.pulling=!1))}onTouchMove(t){if(!this.options.enabled||this.refreshing)return;if(this.element.scrollTop>0)return;this.touchCurrentY=t.touches[0].clientY;const n=this.touchCurrentY-this.touchStartY;n<0||(this.distance=Math.min(n/this.options.resistance,this.options.maxDistance),this.distance>5&&(this.pulling=!0,t.preventDefault(),this.updateIndicator()))}async onTouchEnd(){this.pulling&&!this.refreshing&&this.distance>=this.options.threshold?await this.refresh():this.reset()}updateIndicator(){const t=Math.min(this.distance/this.options.threshold,1),n=180*t;this.indicator.style.height=`${this.distance}px`,this.indicator.style.opacity=t,this.arrow.style.transform=`rotate(${n}deg)`,this.distance>=this.options.threshold?(this.text.textContent="Отпустите для обновления",this.arrow.style.transform="rotate(180deg) scale(1.1)"):this.text.textContent="Потяните для обновления"}async refresh(){this.refreshing=!0,this.pulling=!1,this.indicator.style.height=`${this.options.threshold}px`,this.arrow.style.display="none",this.spinner.style.display="block",this.text.textContent="Обновление...",window.haptic&&window.haptic.medium();try{await this.options.onRefresh(),window.haptic&&window.haptic.success()}catch(t){window.haptic&&window.haptic.error()}finally{setTimeout(()=>{this.reset(),this.refreshing=!1},500)}}reset(){this.pulling=!1,this.distance=0,this.indicator.style.transition="height 0.3s ease, opacity 0.3s ease",this.indicator.style.height="0px",this.indicator.style.opacity="0",this.arrow.style.transform="rotate(0deg)",this.arrow.style.display="block",this.spinner.style.display="none",setTimeout(()=>{this.indicator.style.transition=""},300)}enable(){this.options.enabled=!0}disable(){this.options.enabled=!1}destroy(){this.indicator.remove(),this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}}window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.directive("pull-to-refresh",(t,{expression:n},{evaluate:e,cleanup:i})=>{const a=e(n),s=new d(t,{onRefresh:async()=>{"function"==typeof a&&await a()}});i(()=>{s.destroy()})})}),window.PullToRefresh=d;const h=document.createElement("style");h.textContent="\n    .pull-to-refresh-indicator {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        height: 0;\n        overflow: hidden;\n        display: flex;\n        align-items: flex-end;\n        justify-content: center;\n        background: linear-gradient(to bottom, rgba(249, 250, 251, 0) 0%, rgba(249, 250, 251, 1) 100%);\n        z-index: 10;\n        opacity: 0;\n        transition: none;\n    }\n\n    .pull-to-refresh-content {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding-bottom: 1rem;\n    }\n\n    .pull-to-refresh-spinner,\n    .pull-to-refresh-arrow {\n        margin-bottom: 0.5rem;\n    }\n\n    .pull-to-refresh-spinner {\n        display: none;\n    }\n\n    .pull-to-refresh-arrow {\n        transition: transform 0.2s ease;\n    }\n\n    .pull-to-refresh-text {\n        white-space: nowrap;\n    }\n\n    /* Make sure parent is relative */\n    [x-data][x-pull-to-refresh],\n    .pull-to-refresh-container {\n        position: relative;\n    }\n",document.head.appendChild(h);new class{constructor(){this.isNavigating=!1,this.animationDuration=300,this.previousUrl=window.location.href,this.init()}init(){(window.isPWAInstalled||window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)&&this.setupNavigationDetection()}setupNavigationDetection(){document.addEventListener("click",t=>{const n=t.target.closest("a");if(!n)return;if("_blank"===n.target)return;if(n.download)return;if("external"===n.rel)return;const e=n.href;e&&e.startsWith(window.location.origin)&&e!==window.location.href&&(t.preventDefault(),this.navigateWithTransition(e,"forward"))}),window.addEventListener("popstate",t=>{const n=window.location.href,e=this.getNavigationDirection(n);this.applyTransition(e)})}getNavigationDirection(t){return t.length<this.previousUrl.length?"back":"forward"}async navigateWithTransition(t,n="forward"){this.isNavigating||(this.isNavigating=!0,await this.applyTransition(n,"exit"),window.haptic&&window.haptic.light(),this.previousUrl=window.location.href,window.location.href=t)}async applyTransition(t,n="enter"){const e=document.body;e.classList.remove("page-transition-enter","page-transition-exit","page-transition-forward","page-transition-back"),e.offsetWidth,e.classList.add(`page-transition-${n}`),e.classList.add(`page-transition-${t}`),await new Promise(t=>setTimeout(t,this.animationDuration)),"exit"===n&&(this.isNavigating=!1)}};const p=document.createElement("style");p.textContent="\n    /* Disable default page transitions if user prefers reduced motion */\n    @media (prefers-reduced-motion: reduce) {\n        .page-transition-enter,\n        .page-transition-exit {\n            animation: none !important;\n            transition: none !important;\n        }\n    }\n\n    /* Page transition base */\n    body {\n        transition: none;\n    }\n\n    /* Forward navigation (slide from right) */\n    .page-transition-exit.page-transition-forward {\n        animation: slideOutLeft 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .page-transition-enter.page-transition-forward {\n        animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    /* Back navigation (slide to right) */\n    .page-transition-exit.page-transition-back {\n        animation: slideOutRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .page-transition-enter.page-transition-back {\n        animation: slideInLeft 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    /* Keyframes */\n    @keyframes slideInRight {\n        from {\n            opacity: 0;\n            transform: translateX(100%);\n        }\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes slideOutLeft {\n        from {\n            opacity: 1;\n            transform: translateX(0);\n        }\n        to {\n            opacity: 0;\n            transform: translateX(-30%);\n        }\n    }\n\n    @keyframes slideInLeft {\n        from {\n            opacity: 0;\n            transform: translateX(-30%);\n        }\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes slideOutRight {\n        from {\n            opacity: 1;\n            transform: translateX(0);\n        }\n        to {\n            opacity: 0;\n            transform: translateX(100%);\n        }\n    }\n\n    /* Fade transition (alternative) */\n    .page-transition-fade {\n        animation: fadeTransition 0.3s ease-in-out;\n    }\n\n    @keyframes fadeTransition {\n        0% { opacity: 1; }\n        50% { opacity: 0; }\n        100% { opacity: 1; }\n    }\n\n    /* Ensure smooth rendering */\n    body.page-transition-enter,\n    body.page-transition-exit {\n        overflow-x: hidden;\n    }\n",document.head.appendChild(p),window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.data("actionSheet",()=>({isOpen:!1,actions:[],title:"",message:"",cancelText:"Отмена",open(t={}){this.title=t.title||"",this.message=t.message||"",this.actions=t.actions||[],this.cancelText=t.cancelText||"Отмена",this.isOpen=!0,window.haptic&&window.haptic.light(),document.body.style.overflow="hidden"},close(){this.isOpen=!1,document.body.style.overflow="",setTimeout(()=>{this.actions=[],this.title="",this.message=""},300)},handleAction(t){window.haptic&&(t.destructive?window.haptic.medium():window.haptic.light()),"function"==typeof t.handler&&t.handler(),this.close()}})),Alpine.magic("actionSheet",()=>({show(t){window.dispatchEvent(new CustomEvent("action-sheet:open",{detail:t}))}}))});class m{constructor(t={}){this.container=null,this.backdrop=null,this.sheet=null,this.isOpen=!1,this.options={title:"",message:"",actions:[],cancelText:"Отмена",...t},this.create()}create(){this.backdrop=document.createElement("div"),this.backdrop.className="action-sheet-backdrop",this.backdrop.onclick=()=>this.close(),this.sheet=document.createElement("div"),this.sheet.className="action-sheet",this.sheet.innerHTML=this.renderContent(),this.container=document.createElement("div"),this.container.className="action-sheet-container",this.container.appendChild(this.backdrop),this.container.appendChild(this.sheet),this.attachListeners()}renderContent(){let t='\n            <div class="action-sheet-handle"></div>\n        ';return(this.options.title||this.options.message)&&(t+='<div class="action-sheet-header">',this.options.title&&(t+=`<h3 class="action-sheet-title">${this.options.title}</h3>`),this.options.message&&(t+=`<p class="action-sheet-message">${this.options.message}</p>`),t+="</div>"),t+='<div class="action-sheet-actions">',this.options.actions.forEach((n,e)=>{const i=n.icon?`\n                <svg class="action-sheet-action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    ${n.icon}\n                </svg>\n            `:"",a="action-sheet-action "+(n.destructive?"action-sheet-action-destructive":"");t+=`\n                <button class="${a}" data-action-index="${e}">\n                    ${i}\n                    <span>${n.title}</span>\n                </button>\n            `}),t+="</div>",t+=`\n            <div class="action-sheet-cancel">\n                <button class="action-sheet-action action-sheet-action-cancel">\n                    ${this.options.cancelText}\n                </button>\n            </div>\n        `,t}attachListeners(){this.sheet.querySelectorAll("[data-action-index]").forEach(t=>{t.onclick=()=>{const n=parseInt(t.dataset.actionIndex);this.handleAction(this.options.actions[n])}});const t=this.sheet.querySelector(".action-sheet-action-cancel");t&&(t.onclick=()=>this.close())}handleAction(t){window.haptic&&(t.destructive?window.haptic.medium():window.haptic.light()),"function"==typeof t.handler&&t.handler(),this.close()}open(){this.isOpen||(document.body.appendChild(this.container),this.isOpen=!0,setTimeout(()=>{this.backdrop.classList.add("active"),this.sheet.classList.add("active")},10),document.body.style.overflow="hidden",window.haptic&&window.haptic.light())}close(){this.isOpen&&(this.backdrop.classList.remove("active"),this.sheet.classList.remove("active"),setTimeout(()=>{this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.isOpen=!1,document.body.style.overflow=""},300))}static show(t){const n=new m(t);return n.open(),n}}window.ActionSheet=m;const u=document.createElement("style");u.textContent="\n    /* Action Sheet Styles */\n    .action-sheet-container {\n        position: fixed;\n        inset: 0;\n        z-index: 100;\n        pointer-events: none;\n    }\n\n    .action-sheet-container.active,\n    .action-sheet-container > * {\n        pointer-events: auto;\n    }\n\n    .action-sheet-backdrop {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        opacity: 0;\n        transition: opacity 0.3s ease;\n        backdrop-filter: blur(2px);\n        -webkit-backdrop-filter: blur(2px);\n    }\n\n    .action-sheet-backdrop.active {\n        opacity: 1;\n    }\n\n    .action-sheet {\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        background: white;\n        border-top-left-radius: 1rem;\n        border-top-right-radius: 1rem;\n        transform: translateY(100%);\n        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        max-height: 80vh;\n        overflow-y: auto;\n        padding-bottom: env(safe-area-inset-bottom, 0px);\n        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);\n    }\n\n    .action-sheet.active {\n        transform: translateY(0);\n    }\n\n    .action-sheet-handle {\n        width: 36px;\n        height: 4px;\n        background: #d1d5db;\n        border-radius: 2px;\n        margin: 0.75rem auto;\n    }\n\n    .action-sheet-header {\n        padding: 1rem 1.5rem;\n        text-align: center;\n        border-bottom: 1px solid #f3f4f6;\n    }\n\n    .action-sheet-title {\n        font-size: 1rem;\n        font-weight: 600;\n        color: #111827;\n        margin: 0 0 0.25rem 0;\n    }\n\n    .action-sheet-message {\n        font-size: 0.875rem;\n        color: #6b7280;\n        margin: 0;\n    }\n\n    .action-sheet-actions {\n        padding: 0.5rem 0;\n    }\n\n    .action-sheet-action {\n        display: flex;\n        align-items: center;\n        gap: 0.75rem;\n        width: 100%;\n        padding: 1rem 1.5rem;\n        font-size: 1rem;\n        color: #111827;\n        background: transparent;\n        border: none;\n        text-align: left;\n        cursor: pointer;\n        transition: background-color 0.15s ease;\n        -webkit-tap-highlight-color: transparent;\n    }\n\n    .action-sheet-action:active {\n        background-color: #f9fafb;\n    }\n\n    .action-sheet-action-icon {\n        width: 1.5rem;\n        height: 1.5rem;\n        flex-shrink: 0;\n    }\n\n    .action-sheet-action-destructive {\n        color: #dc2626;\n    }\n\n    .action-sheet-cancel {\n        margin-top: 0.5rem;\n        padding: 0.5rem;\n        background: #f9fafb;\n    }\n\n    .action-sheet-action-cancel {\n        width: 100%;\n        padding: 1rem;\n        font-size: 1rem;\n        font-weight: 600;\n        color: #2563eb;\n        background: white;\n        border: none;\n        border-radius: 0.75rem;\n        cursor: pointer;\n        transition: background-color 0.15s ease;\n        -webkit-tap-highlight-color: transparent;\n    }\n\n    .action-sheet-action-cancel:active {\n        background-color: #f3f4f6;\n    }\n\n    /* Dark mode support */\n    @media (prefers-color-scheme: dark) {\n        .action-sheet {\n            background: #1f2937;\n        }\n\n        .action-sheet-title {\n            color: #f9fafb;\n        }\n\n        .action-sheet-message {\n            color: #9ca3af;\n        }\n\n        .action-sheet-action {\n            color: #f9fafb;\n        }\n\n        .action-sheet-action:active {\n            background-color: #374151;\n        }\n\n        .action-sheet-cancel {\n            background: #111827;\n        }\n\n        .action-sheet-action-cancel {\n            background: #374151;\n            color: #60a5fa;\n        }\n\n        .action-sheet-action-cancel:active {\n            background-color: #4b5563;\n        }\n    }\n",document.head.appendChild(u);const g=new class{constructor(){this.toasts=[],this.container=null,this.maxToasts=3,this.defaultDuration=3e3,this.init()}init(){document.querySelector(".toast-container")?this.container=document.querySelector(".toast-container"):(this.container=document.createElement("div"),this.container.className="toast-container",document.body.appendChild(this.container))}show(t={}){const n={id:Date.now()+Math.random(),type:t.type||"info",message:t.message||"",title:t.title||"",duration:void 0!==t.duration?t.duration:this.defaultDuration,action:t.action||null,dismissible:!1!==t.dismissible,icon:t.icon||this.getDefaultIcon(t.type||"info")};return this.toasts.length>=this.maxToasts&&this.dismiss(this.toasts[0].id),this.toasts.push(n),this.render(n),n.duration>0&&setTimeout(()=>{this.dismiss(n.id)},n.duration),window.haptic&&("error"===n.type?window.haptic.error():"success"===n.type?window.haptic.success():window.haptic.light()),n.id}getDefaultIcon(t){const n={success:"M5 13l4 4L19 7",error:"M6 18L18 6M6 6l12 12",warning:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",info:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"};return n[t]||n.info}render(t){const n=document.createElement("div");n.className=`toast toast-${t.type}`,n.dataset.toastId=t.id,n.setAttribute("role","alert"),n.setAttribute("aria-live","polite");const e={success:"text-green-500",error:"text-red-500",warning:"text-yellow-500",info:"text-blue-500"},i={success:"bg-green-50 border-green-200",error:"bg-red-50 border-red-200",warning:"bg-yellow-50 border-yellow-200",info:"bg-blue-50 border-blue-200"};if(n.innerHTML=`\n            <div class="toast-content ${i[t.type]||i.info}">\n                <div class="toast-icon ${e[t.type]||e.info}">\n                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t.icon}"></path>\n                    </svg>\n                </div>\n                <div class="toast-body">\n                    ${t.title?`<div class="toast-title">${t.title}</div>`:""}\n                    <div class="toast-message">${t.message}</div>\n                </div>\n                ${t.action?`\n                    <button class="toast-action" data-action="${t.id}">\n                        ${t.action.label}\n                    </button>\n                `:""}\n                ${t.dismissible?`\n                    <button class="toast-close" data-close="${t.id}" aria-label="Закрыть">\n                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n                        </svg>\n                    </button>\n                `:""}\n            </div>\n        `,this.container.appendChild(n),setTimeout(()=>{n.classList.add("toast-show")},10),t.action){n.querySelector("[data-action]").onclick=()=>{"function"==typeof t.action.handler&&t.action.handler(),this.dismiss(t.id)}}if(t.dismissible){n.querySelector("[data-close]").onclick=()=>{this.dismiss(t.id)}}let a=0,s=0,o=!1;n.addEventListener("touchstart",t=>{a=t.touches[0].clientX,o=!0,n.style.transition="none"}),n.addEventListener("touchmove",t=>{if(!o)return;s=t.touches[0].clientX;const e=s-a;e>0&&(n.style.transform=`translateX(${e}px)`,n.style.opacity=Math.max(0,1-e/200))}),n.addEventListener("touchend",()=>{if(!o)return;o=!1;const e=s-a;n.style.transition="",e>100?this.dismiss(t.id):(n.style.transform="",n.style.opacity=""),a=0,s=0})}dismiss(t){const n=this.container.querySelector(`[data-toast-id="${t}"]`);n&&(n.classList.remove("toast-show"),n.classList.add("toast-hide"),setTimeout(()=>{n.remove(),this.toasts=this.toasts.filter(n=>n.id!==t)},300))}success(t,n={}){return this.show({type:"success",message:t,...n})}error(t,n={}){return this.show({type:"error",message:t,duration:5e3,...n})}warning(t,n={}){return this.show({type:"warning",message:t,...n})}info(t,n={}){return this.show({type:"info",message:t,...n})}loading(t,n={}){return this.show({type:"info",message:t,duration:0,dismissible:!1,icon:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15",...n})}dismissAll(){this.toasts.forEach(t=>{this.dismiss(t.id)})}};window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.magic("toast",()=>g),Alpine.store("toast",{show:t=>g.show(t),success:(t,n)=>g.success(t,n),error:(t,n)=>g.error(t,n),warning:(t,n)=>g.warning(t,n),info:(t,n)=>g.info(t,n),loading:(t,n)=>g.loading(t,n),dismiss:t=>g.dismiss(t)})}),window.toast=g;const w=document.createElement("style");w.textContent='\n    /* Toast Container */\n    .toast-container {\n        position: fixed;\n        top: 1rem;\n        right: 1rem;\n        z-index: 9999;\n        display: flex;\n        flex-direction: column;\n        gap: 0.75rem;\n        pointer-events: none;\n        max-width: calc(100vw - 2rem);\n    }\n\n    @media (max-width: 640px) {\n        .toast-container {\n            top: auto;\n            bottom: calc(env(safe-area-inset-bottom, 0px) + 5rem);\n            left: 1rem;\n            right: 1rem;\n        }\n    }\n\n    /* Toast Base */\n    .toast {\n        pointer-events: auto;\n        transform: translateX(calc(100% + 1rem));\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        will-change: transform, opacity;\n    }\n\n    @media (max-width: 640px) {\n        .toast {\n            transform: translateY(calc(100% + 1rem));\n        }\n    }\n\n    .toast-show {\n        transform: translateX(0) !important;\n        opacity: 1 !important;\n    }\n\n    @media (max-width: 640px) {\n        .toast-show {\n            transform: translateY(0) !important;\n        }\n    }\n\n    .toast-hide {\n        transform: translateX(calc(100% + 1rem)) !important;\n        opacity: 0 !important;\n    }\n\n    @media (max-width: 640px) {\n        .toast-hide {\n            transform: translateY(calc(100% + 1rem)) !important;\n        }\n    }\n\n    /* Toast Content */\n    .toast-content {\n        display: flex;\n        align-items: flex-start;\n        gap: 0.75rem;\n        padding: 1rem;\n        background: white;\n        border: 1px solid;\n        border-radius: 0.75rem;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);\n        min-width: 300px;\n        max-width: 400px;\n    }\n\n    @media (max-width: 640px) {\n        .toast-content {\n            min-width: 0;\n            max-width: 100%;\n        }\n    }\n\n    .toast-icon {\n        flex-shrink: 0;\n        margin-top: 0.125rem;\n    }\n\n    .toast-body {\n        flex: 1;\n        min-width: 0;\n    }\n\n    .toast-title {\n        font-weight: 600;\n        font-size: 0.875rem;\n        color: #111827;\n        margin-bottom: 0.25rem;\n    }\n\n    .toast-message {\n        font-size: 0.875rem;\n        color: #4b5563;\n        line-height: 1.4;\n        word-wrap: break-word;\n    }\n\n    .toast-action {\n        flex-shrink: 0;\n        padding: 0.25rem 0.75rem;\n        font-size: 0.875rem;\n        font-weight: 600;\n        color: #2563eb;\n        background: transparent;\n        border: none;\n        border-radius: 0.375rem;\n        cursor: pointer;\n        transition: background-color 0.15s ease;\n        white-space: nowrap;\n    }\n\n    .toast-action:hover {\n        background-color: rgba(37, 99, 235, 0.1);\n    }\n\n    .toast-action:active {\n        background-color: rgba(37, 99, 235, 0.2);\n    }\n\n    .toast-close {\n        flex-shrink: 0;\n        padding: 0.25rem;\n        color: #6b7280;\n        background: transparent;\n        border: none;\n        border-radius: 0.25rem;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        line-height: 0;\n    }\n\n    .toast-close:hover {\n        color: #111827;\n        background-color: rgba(0, 0, 0, 0.05);\n    }\n\n    .toast-close:active {\n        background-color: rgba(0, 0, 0, 0.1);\n    }\n\n    /* Success */\n    .toast-success .toast-title {\n        color: #065f46;\n    }\n\n    .toast-success .toast-message {\n        color: #047857;\n    }\n\n    /* Error */\n    .toast-error .toast-title {\n        color: #991b1b;\n    }\n\n    .toast-error .toast-message {\n        color: #dc2626;\n    }\n\n    /* Warning */\n    .toast-warning .toast-title {\n        color: #92400e;\n    }\n\n    .toast-warning .toast-message {\n        color: #d97706;\n    }\n\n    /* Info */\n    .toast-info .toast-title {\n        color: #1e40af;\n    }\n\n    .toast-info .toast-message {\n        color: #2563eb;\n    }\n\n    /* Dark mode support */\n    @media (prefers-color-scheme: dark) {\n        .toast-content {\n            background: #1f2937;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);\n        }\n\n        .toast-title {\n            color: #f9fafb;\n        }\n\n        .toast-message {\n            color: #d1d5db;\n        }\n\n        .toast-close {\n            color: #9ca3af;\n        }\n\n        .toast-close:hover {\n            color: #f9fafb;\n            background-color: rgba(255, 255, 255, 0.1);\n        }\n\n        .bg-green-50 {\n            background: rgba(16, 185, 129, 0.1) !important;\n        }\n\n        .bg-red-50 {\n            background: rgba(239, 68, 68, 0.1) !important;\n        }\n\n        .bg-yellow-50 {\n            background: rgba(245, 158, 11, 0.1) !important;\n        }\n\n        .bg-blue-50 {\n            background: rgba(59, 130, 246, 0.1) !important;\n        }\n\n        .border-green-200 {\n            border-color: rgba(16, 185, 129, 0.3) !important;\n        }\n\n        .border-red-200 {\n            border-color: rgba(239, 68, 68, 0.3) !important;\n        }\n\n        .border-yellow-200 {\n            border-color: rgba(245, 158, 11, 0.3) !important;\n        }\n\n        .border-blue-200 {\n            border-color: rgba(59, 130, 246, 0.3) !important;\n        }\n\n        .toast-success .toast-message {\n            color: #34d399;\n        }\n\n        .toast-error .toast-message {\n            color: #f87171;\n        }\n\n        .toast-warning .toast-message {\n            color: #fbbf24;\n        }\n\n        .toast-info .toast-message {\n            color: #60a5fa;\n        }\n    }\n\n    /* Reduce motion */\n    @media (prefers-reduced-motion: reduce) {\n        .toast {\n            transition: none !important;\n        }\n    }\n\n    /* Loading spinner animation */\n    @keyframes spin {\n        to {\n            transform: rotate(360deg);\n        }\n    }\n\n    .toast [d*="M4 4v5h.582"] {\n        animation: spin 1s linear infinite;\n        transform-origin: center;\n    }\n',document.head.appendChild(w);const f=t.create({baseURL:"/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});f.interceptors.request.use(t=>{let n=localStorage.getItem("_x_auth_token");if(n)try{n=JSON.parse(n)}catch(e){}return n||(n=localStorage.getItem("auth_token")),n&&(t.headers.Authorization=`Bearer ${n}`),t}),f.interceptors.response.use(t=>t,t=>(401===t.response?.status&&(localStorage.removeItem("_x_auth_token"),localStorage.removeItem("_x_auth_user"),localStorage.removeItem("_x_current_company"),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),window.location.pathname.includes("/login")||(window.location.href="/login")),Promise.reject(t)));const b={register:async t=>(await f.post("/auth/register",t)).data,login:async(t,n)=>(await f.post("/auth/login",{email:t,password:n})).data,async logout(){try{await f.post("/auth/logout")}catch(t){}localStorage.removeItem("_x_auth_token"),localStorage.removeItem("_x_auth_user"),localStorage.removeItem("_x_current_company"),localStorage.removeItem("auth_token"),localStorage.removeItem("user")},me:async()=>(await f.get("/me")).data,getUser(){const t=localStorage.getItem("user");return t?JSON.parse(t):null},isAuthenticated:()=>!!localStorage.getItem("auth_token")},v={list:async()=>(await f.get("/companies")).data.companies,create:async t=>(await f.post("/companies",t)).data.company},y={list:async(t,n={})=>(await f.get("/products",{params:{company_id:t,...n}})).data,get:async t=>(await f.get(`/products/${t}`)).data.product,create:async t=>(await f.post("/products",t)).data.product,update:async(t,n)=>(await f.put(`/products/${t}`,n)).data.product,async delete(t){await f.delete(`/products/${t}`)}},k={list:async(t,n={})=>(await f.get("/dialogs",{params:{company_id:t,...n}})).data,get:async t=>(await f.get(`/dialogs/${t}`)).data.dialog,create:async(t,n=null,e="general",i=!1)=>(await f.post("/dialogs",{company_id:t,title:n,category:e,is_private:i})).data.dialog,hide:async t=>(await f.post(`/dialogs/${t}/hide`)).data},x={send:async t=>(await f.post("/chat",t)).data,generateCard:async t=>(await f.post("/chat/generate-card",t)).data.card,generateReviewResponse:async t=>(await f.post("/chat/generate-review-response",t)).data.responses},S={async upload(t,n,e=!1){const i=new FormData;i.append("image",n),i.append("is_primary",e);return(await f.post(`/products/${t}/images/upload`,i,{headers:{"Content-Type":"multipart/form-data"}})).data.image},generate:async(t,n,e="medium",i=1)=>(await f.post(`/products/${t}/images/generate`,{prompt:n,quality:e,count:i})).data.images},C={list:async(t,n={})=>(await f.get("/agent/tasks",{params:{company_id:t,...n}})).data,get:async t=>(await f.get(`/agent/tasks/${t}`)).data.task,create:async(t,n,e)=>(await f.post("/agent/tasks",{company_id:t,type:n,input_data:e})).data.task};function _(t,e){try{return n.$persist(t).as(e)}catch(i){return localStorage.removeItem("_x_"+e),localStorage.removeItem(e),t}}n.plugin(e);try{["auth_user","auth_token","current_company"].forEach(t=>{const n="_x_"+t,e=localStorage.getItem(n);if(e)try{JSON.parse(e)}catch(i){localStorage.removeItem(n),localStorage.removeItem(t)}})}catch(T){}window.api={...f,auth:b,companies:v,products:y,dialogs:k,chat:x,images:S,tasks:C,get:f.get,post:f.post,delete:f.delete},n.store("auth",{user:_(null,"auth_user"),token:_(null,"auth_token"),currentCompany:_(null,"current_company"),companies:[],showCompanyPrompt:!1,get isAuthenticated(){return!!this.token},get hasCompanies(){return this.companies.length>0},async login(t,n){const e=await b.login(t,n);return this.user=e.user,this.token=e.token,await this.loadCompanies(),e},async register(t){const n=await b.register(t);return this.user=n.user,this.token=n.token,await this.loadCompanies(),n},async loadCompanies(){try{if(this.companies=await v.list(),this.companies.length>0){if(!(this.currentCompany&&this.companies.some(t=>t.id===this.currentCompany.id))){const t=this.user?.company_id,n=t?this.companies.find(n=>n.id===t):null;this.currentCompany=n||this.companies[0]}this.showCompanyPrompt=!1}else this.showCompanyPrompt=!0,this.currentCompany=null;this.currentCompany&&await n.store("chat").loadDialogs(this.currentCompany.id)}catch(T){}},async logout(){await b.logout(),this.user=null,this.token=null,this.currentCompany=null,this.companies=[]},setCompany(t){this.currentCompany=t,t&&n.store("chat").loadDialogs(t.id)}}),n.store("chat",{dialogs:[],currentDialog:null,messages:[],loading:!1,async loadDialogs(t){try{const n=await k.list(t);this.dialogs=n.dialogs||[]}catch(T){this.dialogs=[]}},async loadDialog(t){this.loading=!0;const n=await k.get(t);this.currentDialog=n,this.messages=n.messages||[],this.loading=!1},async sendMessage(t,e={}){this.loading=!0;const i={message:t,mode:e.mode||"chat",model:e.model||"fast"};if(e.image_model&&(i.image_model=e.image_model),e.is_private&&(i.is_private=!0),this.currentDialog)i.dialog_id=this.currentDialog.id;else{const t=n.store("auth");i.company_id=t.currentCompany?.id}e.images?.length&&(i.images=e.images);const a={id:"temp-"+Date.now(),sender:"user",content:t,created_at:(new Date).toISOString()};this.messages.push(a);try{const t=await x.send(i);if(this.currentDialog){const n=this.dialogs.findIndex(n=>n.id===t.dialog.id);-1!==n&&(this.dialogs[n]=t.dialog)}else this.currentDialog=t.dialog,this.dialogs.unshift(t.dialog);const n=this.messages.findIndex(t=>t.id===a.id);return-1!==n&&(this.messages[n]=t.user_message),this.messages.push(t.assistant_message),this.loading=!1,t}catch(s){throw this.messages=this.messages.filter(t=>t.id!==a.id),this.loading=!1,s}},newChat(){this.currentDialog=null,this.messages=[]}}),n.store("products",{items:[],current:null,loading:!1,meta:{},async load(t,n={}){this.loading=!0;const e=await y.list(t,n);this.items=e.products,this.meta=e.meta,this.loading=!1},async get(t){return this.loading=!0,this.current=await y.get(t),this.loading=!1,this.current},async create(t){const n=await y.create(t);return this.items.unshift(n),n}}),window.Alpine=n,n.start();
