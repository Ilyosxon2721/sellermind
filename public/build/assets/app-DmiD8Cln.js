import{a as t}from"./vendor-Dos3PyFQ.js";import{m as e,a as n}from"./alpine-w3y3or6b.js";window.axios=t,window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";let i=null,s=null,a=!1;const o=new Set,r=new Set;let c=0;window.subscribeToChannel=function(t){return r.add(t),!(!i||i.readyState!==WebSocket.OPEN)&&(o.has(t)||(i.send(JSON.stringify({event:"pusher:subscribe",data:{channel:t}})),o.add(t)),!0)},window.unsubscribeFromChannel=function(t){r.delete(t),i&&i.readyState===WebSocket.OPEN&&(i.send(JSON.stringify({event:"pusher:unsubscribe",data:{channel:t}})),o.delete(t))},window.getWebSocketState=function(){return{connected:a,socketId:s,connection:i,reconnectAttempts:c}},window.reconnectWebSocket=function(){i&&i.close(),c=0};window.pollingManager=new class{constructor(){this.intervals=new Map,this.callbacks=new Map,this.lastCheckTimes=new Map,this.isActive=!0,this.config=window.pollingConfig||{}}start(t,e,n,i=15e3){this.intervals.has(t)&&this.stop(t),this.callbacks.set(t,n),this.lastCheckTimes.set(t,(new Date).toISOString());const s=async()=>{if(this.isActive)try{const i=e.includes("?")?"&":"?",s=`${e}${i}last_check=${this.lastCheckTimes.get(t)}`,a=await fetch(s,{headers:{Authorization:`Bearer ${this.getToken()}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!a.ok){if(401===a.status)return void this.stop(t);throw new Error(`HTTP ${a.status}: ${a.statusText}`)}const o=await a.json();o.timestamp&&this.lastCheckTimes.set(t,o.timestamp),n&&"function"==typeof n&&n(o)}catch(i){}};s();const a=setInterval(s,i);this.intervals.set(t,a)}stop(t){this.intervals.has(t)&&(clearInterval(this.intervals.get(t)),this.intervals.delete(t),this.callbacks.delete(t),this.lastCheckTimes.delete(t))}stopAll(){this.intervals.forEach((t,e)=>{clearInterval(t)}),this.intervals.clear(),this.callbacks.clear(),this.lastCheckTimes.clear()}pause(){this.isActive=!1}resume(){this.isActive=!0,this.intervals.forEach((t,e)=>{this.callbacks.get(e)&&setTimeout(()=>{},100)})}getStats(){return{active_count:this.intervals.size,is_active:this.isActive,keys:Array.from(this.intervals.keys())}}isRunning(t){return this.intervals.has(t)}getToken(){const t=localStorage.getItem("auth_token");if(t)return t;const e=document.querySelector('meta[name="csrf-token"]');return e?e.content:window.authToken?window.authToken:""}},document.addEventListener("visibilitychange",()=>{document.hidden?window.pollingManager.pause():window.pollingManager.resume()}),window.addEventListener("beforeunload",()=>{window.pollingManager.stopAll()});const l=new class{constructor(){this.isSupported="vibrate"in navigator,this.isEnabled=!0;const t=localStorage.getItem("haptic_enabled");null!==t&&(this.isEnabled="true"===t)}enable(){this.isEnabled=!0,localStorage.setItem("haptic_enabled","true")}disable(){this.isEnabled=!1,localStorage.setItem("haptic_enabled","false")}toggle(){return this.isEnabled?this.disable():this.enable(),this.isEnabled}canVibrate(){return this.isSupported&&this.isEnabled}light(){this.canVibrate()&&navigator.vibrate(10)}medium(){this.canVibrate()&&navigator.vibrate(20)}heavy(){this.canVibrate()&&navigator.vibrate(40)}success(){this.canVibrate()&&navigator.vibrate([10,50,10])}error(){this.canVibrate()&&navigator.vibrate([30,50,30,50,30])}notification(){this.canVibrate()&&navigator.vibrate([15,30,15])}selection(){this.canVibrate()&&navigator.vibrate(5)}impact(){this.canVibrate()&&navigator.vibrate(25)}custom(t){this.canVibrate()&&navigator.vibrate(t)}};window.haptic=l,window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.magic("haptic",()=>l)}),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",t=>{const e=t.target.closest("[data-haptic]");if(!e)return;switch(e.dataset.haptic||"light"){case"light":default:l.light();break;case"medium":l.medium();break;case"heavy":l.heavy();break;case"success":l.success();break;case"error":l.error();break;case"selection":l.selection();break;case"impact":l.impact()}}),l.isSupported});class h{constructor(t,e={}){this.element=t,this.options={threshold:80,maxDistance:120,resistance:2.5,onRefresh:e.onRefresh||(()=>Promise.resolve()),enabled:!0,...e},this.touchStartY=0,this.touchCurrentY=0,this.pulling=!1,this.refreshing=!1,this.distance=0,this.createIndicator(),this.attachListeners()}createIndicator(){this.indicator=document.createElement("div"),this.indicator.className="pull-to-refresh-indicator",this.indicator.innerHTML='\n            <div class="pull-to-refresh-content">\n                <div class="pull-to-refresh-spinner">\n                    <svg class="animate-spin h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24">\n                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n                    </svg>\n                </div>\n                <div class="pull-to-refresh-arrow">\n                    <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>\n                    </svg>\n                </div>\n                <div class="pull-to-refresh-text text-sm font-medium text-gray-600"></div>\n            </div>\n        ',this.element.parentNode.insertBefore(this.indicator,this.element),this.spinner=this.indicator.querySelector(".pull-to-refresh-spinner"),this.arrow=this.indicator.querySelector(".pull-to-refresh-arrow"),this.text=this.indicator.querySelector(".pull-to-refresh-text")}attachListeners(){this.element.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.element.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.element.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0})}onTouchStart(t){this.options.enabled&&!this.refreshing&&(this.element.scrollTop>0||(this.touchStartY=t.touches[0].clientY,this.pulling=!1))}onTouchMove(t){if(!this.options.enabled||this.refreshing)return;if(this.element.scrollTop>0)return;this.touchCurrentY=t.touches[0].clientY;const e=this.touchCurrentY-this.touchStartY;e<0||(this.distance=Math.min(e/this.options.resistance,this.options.maxDistance),this.distance>5&&(this.pulling=!0,t.preventDefault(),this.updateIndicator()))}async onTouchEnd(){this.pulling&&!this.refreshing&&this.distance>=this.options.threshold?await this.refresh():this.reset()}updateIndicator(){const t=Math.min(this.distance/this.options.threshold,1),e=180*t;this.indicator.style.height=`${this.distance}px`,this.indicator.style.opacity=t,this.arrow.style.transform=`rotate(${e}deg)`,this.distance>=this.options.threshold?(this.text.textContent="Отпустите для обновления",this.arrow.style.transform="rotate(180deg) scale(1.1)"):this.text.textContent="Потяните для обновления"}async refresh(){this.refreshing=!0,this.pulling=!1,this.indicator.style.height=`${this.options.threshold}px`,this.arrow.style.display="none",this.spinner.style.display="block",this.text.textContent="Обновление...",window.haptic&&window.haptic.medium();try{await this.options.onRefresh(),window.haptic&&window.haptic.success()}catch(t){window.haptic&&window.haptic.error()}finally{setTimeout(()=>{this.reset(),this.refreshing=!1},500)}}reset(){this.pulling=!1,this.distance=0,this.indicator.style.transition="height 0.3s ease, opacity 0.3s ease",this.indicator.style.height="0px",this.indicator.style.opacity="0",this.arrow.style.transform="rotate(0deg)",this.arrow.style.display="block",this.spinner.style.display="none",setTimeout(()=>{this.indicator.style.transition=""},300)}enable(){this.options.enabled=!0}disable(){this.options.enabled=!1}destroy(){this.indicator.remove(),this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}}window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.directive("pull-to-refresh",(t,{expression:e},{evaluate:n,cleanup:i})=>{const s=n(e),a=new h(t,{onRefresh:async()=>{"function"==typeof s&&await s()}});i(()=>{a.destroy()})})}),window.PullToRefresh=h;const d=document.createElement("style");d.textContent="\n    .pull-to-refresh-indicator {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        height: 0;\n        overflow: hidden;\n        display: flex;\n        align-items: flex-end;\n        justify-content: center;\n        background: linear-gradient(to bottom, rgba(249, 250, 251, 0) 0%, rgba(249, 250, 251, 1) 100%);\n        z-index: 10;\n        opacity: 0;\n        transition: none;\n    }\n\n    .pull-to-refresh-content {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding-bottom: 1rem;\n    }\n\n    .pull-to-refresh-spinner,\n    .pull-to-refresh-arrow {\n        margin-bottom: 0.5rem;\n    }\n\n    .pull-to-refresh-spinner {\n        display: none;\n    }\n\n    .pull-to-refresh-arrow {\n        transition: transform 0.2s ease;\n    }\n\n    .pull-to-refresh-text {\n        white-space: nowrap;\n    }\n\n    /* Make sure parent is relative */\n    [x-data][x-pull-to-refresh],\n    .pull-to-refresh-container {\n        position: relative;\n    }\n",document.head.appendChild(d);new class{constructor(){this.isNavigating=!1,this.animationDuration=300,this.previousUrl=window.location.href,this.init()}init(){(window.isPWAInstalled||window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)&&this.setupNavigationDetection()}setupNavigationDetection(){document.addEventListener("click",t=>{const e=t.target.closest("a");if(!e)return;if("_blank"===e.target)return;if(e.download)return;if("external"===e.rel)return;const n=e.href;n&&n.startsWith(window.location.origin)&&n!==window.location.href&&(t.preventDefault(),this.navigateWithTransition(n,"forward"))}),window.addEventListener("popstate",t=>{const e=window.location.href,n=this.getNavigationDirection(e);this.applyTransition(n)})}getNavigationDirection(t){return t.length<this.previousUrl.length?"back":"forward"}async navigateWithTransition(t,e="forward"){this.isNavigating||(this.isNavigating=!0,await this.applyTransition(e,"exit"),window.haptic&&window.haptic.light(),this.previousUrl=window.location.href,window.location.href=t)}async applyTransition(t,e="enter"){const n=document.body;n.classList.remove("page-transition-enter","page-transition-exit","page-transition-forward","page-transition-back"),n.offsetWidth,n.classList.add(`page-transition-${e}`),n.classList.add(`page-transition-${t}`),await new Promise(t=>setTimeout(t,this.animationDuration)),"exit"===e&&(this.isNavigating=!1)}};const p=document.createElement("style");p.textContent="\n    /* Disable default page transitions if user prefers reduced motion */\n    @media (prefers-reduced-motion: reduce) {\n        .page-transition-enter,\n        .page-transition-exit {\n            animation: none !important;\n            transition: none !important;\n        }\n    }\n\n    /* Page transition base */\n    body {\n        transition: none;\n    }\n\n    /* Forward navigation (slide from right) */\n    .page-transition-exit.page-transition-forward {\n        animation: slideOutLeft 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .page-transition-enter.page-transition-forward {\n        animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    /* Back navigation (slide to right) */\n    .page-transition-exit.page-transition-back {\n        animation: slideOutRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .page-transition-enter.page-transition-back {\n        animation: slideInLeft 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    /* Keyframes */\n    @keyframes slideInRight {\n        from {\n            opacity: 0;\n            transform: translateX(100%);\n        }\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes slideOutLeft {\n        from {\n            opacity: 1;\n            transform: translateX(0);\n        }\n        to {\n            opacity: 0;\n            transform: translateX(-30%);\n        }\n    }\n\n    @keyframes slideInLeft {\n        from {\n            opacity: 0;\n            transform: translateX(-30%);\n        }\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes slideOutRight {\n        from {\n            opacity: 1;\n            transform: translateX(0);\n        }\n        to {\n            opacity: 0;\n            transform: translateX(100%);\n        }\n    }\n\n    /* Fade transition (alternative) */\n    .page-transition-fade {\n        animation: fadeTransition 0.3s ease-in-out;\n    }\n\n    @keyframes fadeTransition {\n        0% { opacity: 1; }\n        50% { opacity: 0; }\n        100% { opacity: 1; }\n    }\n\n    /* Ensure smooth rendering */\n    body.page-transition-enter,\n    body.page-transition-exit {\n        overflow-x: hidden;\n    }\n",document.head.appendChild(p),document.addEventListener("alpine:init",()=>{window.Alpine&&(window.Alpine.data("actionSheet",()=>({isOpen:!1,actions:[],title:"",message:"",cancelText:"Отмена",open(t={}){this.title=t.title||"",this.message=t.message||"",this.actions=t.actions||[],this.cancelText=t.cancelText||"Отмена",this.isOpen=!0,window.haptic&&window.haptic.light(),document.body.style.overflow="hidden"},close(){this.isOpen=!1,document.body.style.overflow="",setTimeout(()=>{this.actions=[],this.title="",this.message=""},300)},handleAction(t){window.haptic&&(t.destructive?window.haptic.medium():window.haptic.light()),"function"==typeof t.handler&&t.handler(),this.close()}})),window.Alpine.magic("actionSheet",()=>({show(t){window.dispatchEvent(new CustomEvent("action-sheet:open",{detail:t}))}})))});class m{constructor(t={}){this.container=null,this.backdrop=null,this.sheet=null,this.isOpen=!1,this.options={title:"",message:"",actions:[],cancelText:"Отмена",...t},this.create()}create(){this.backdrop=document.createElement("div"),this.backdrop.className="action-sheet-backdrop",this.backdrop.onclick=()=>this.close(),this.sheet=document.createElement("div"),this.sheet.className="action-sheet",this.sheet.innerHTML=this.renderContent(),this.container=document.createElement("div"),this.container.className="action-sheet-container",this.container.appendChild(this.backdrop),this.container.appendChild(this.sheet),this.attachListeners()}renderContent(){let t='\n            <div class="action-sheet-handle"></div>\n        ';return(this.options.title||this.options.message)&&(t+='<div class="action-sheet-header">',this.options.title&&(t+=`<h3 class="action-sheet-title">${this.options.title}</h3>`),this.options.message&&(t+=`<p class="action-sheet-message">${this.options.message}</p>`),t+="</div>"),t+='<div class="action-sheet-actions">',this.options.actions.forEach((e,n)=>{const i=e.icon?`\n                <svg class="action-sheet-action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    ${e.icon}\n                </svg>\n            `:"",s="action-sheet-action "+(e.destructive?"action-sheet-action-destructive":"");t+=`\n                <button class="${s}" data-action-index="${n}">\n                    ${i}\n                    <span>${e.title}</span>\n                </button>\n            `}),t+="</div>",t+=`\n            <div class="action-sheet-cancel">\n                <button class="action-sheet-action action-sheet-action-cancel">\n                    ${this.options.cancelText}\n                </button>\n            </div>\n        `,t}attachListeners(){this.sheet.querySelectorAll("[data-action-index]").forEach(t=>{t.onclick=()=>{const e=parseInt(t.dataset.actionIndex);this.handleAction(this.options.actions[e])}});const t=this.sheet.querySelector(".action-sheet-action-cancel");t&&(t.onclick=()=>this.close())}handleAction(t){window.haptic&&(t.destructive?window.haptic.medium():window.haptic.light()),"function"==typeof t.handler&&t.handler(),this.close()}open(){this.isOpen||(document.body.appendChild(this.container),this.isOpen=!0,setTimeout(()=>{this.backdrop.classList.add("active"),this.sheet.classList.add("active")},10),document.body.style.overflow="hidden",window.haptic&&window.haptic.light())}close(){this.isOpen&&(this.backdrop.classList.remove("active"),this.sheet.classList.remove("active"),setTimeout(()=>{this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.isOpen=!1,document.body.style.overflow=""},300))}static show(t){const e=new m(t);return e.open(),e}}window.ActionSheet=m;const u=document.createElement("style");u.textContent="\n    /* Action Sheet Styles */\n    .action-sheet-container {\n        position: fixed;\n        inset: 0;\n        z-index: 100;\n        pointer-events: none;\n    }\n\n    .action-sheet-container.active,\n    .action-sheet-container > * {\n        pointer-events: auto;\n    }\n\n    .action-sheet-backdrop {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        opacity: 0;\n        transition: opacity 0.3s ease;\n        backdrop-filter: blur(2px);\n        -webkit-backdrop-filter: blur(2px);\n    }\n\n    .action-sheet-backdrop.active {\n        opacity: 1;\n    }\n\n    .action-sheet {\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        background: white;\n        border-top-left-radius: 1rem;\n        border-top-right-radius: 1rem;\n        transform: translateY(100%);\n        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        max-height: 80vh;\n        overflow-y: auto;\n        padding-bottom: env(safe-area-inset-bottom, 0px);\n        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);\n    }\n\n    .action-sheet.active {\n        transform: translateY(0);\n    }\n\n    .action-sheet-handle {\n        width: 36px;\n        height: 4px;\n        background: #d1d5db;\n        border-radius: 2px;\n        margin: 0.75rem auto;\n    }\n\n    .action-sheet-header {\n        padding: 1rem 1.5rem;\n        text-align: center;\n        border-bottom: 1px solid #f3f4f6;\n    }\n\n    .action-sheet-title {\n        font-size: 1rem;\n        font-weight: 600;\n        color: #111827;\n        margin: 0 0 0.25rem 0;\n    }\n\n    .action-sheet-message {\n        font-size: 0.875rem;\n        color: #6b7280;\n        margin: 0;\n    }\n\n    .action-sheet-actions {\n        padding: 0.5rem 0;\n    }\n\n    .action-sheet-action {\n        display: flex;\n        align-items: center;\n        gap: 0.75rem;\n        width: 100%;\n        padding: 1rem 1.5rem;\n        font-size: 1rem;\n        color: #111827;\n        background: transparent;\n        border: none;\n        text-align: left;\n        cursor: pointer;\n        transition: background-color 0.15s ease;\n        -webkit-tap-highlight-color: transparent;\n    }\n\n    .action-sheet-action:active {\n        background-color: #f9fafb;\n    }\n\n    .action-sheet-action-icon {\n        width: 1.5rem;\n        height: 1.5rem;\n        flex-shrink: 0;\n    }\n\n    .action-sheet-action-destructive {\n        color: #dc2626;\n    }\n\n    .action-sheet-cancel {\n        margin-top: 0.5rem;\n        padding: 0.5rem;\n        background: #f9fafb;\n    }\n\n    .action-sheet-action-cancel {\n        width: 100%;\n        padding: 1rem;\n        font-size: 1rem;\n        font-weight: 600;\n        color: #2563eb;\n        background: white;\n        border: none;\n        border-radius: 0.75rem;\n        cursor: pointer;\n        transition: background-color 0.15s ease;\n        -webkit-tap-highlight-color: transparent;\n    }\n\n    .action-sheet-action-cancel:active {\n        background-color: #f3f4f6;\n    }\n\n    /* Dark mode support */\n    @media (prefers-color-scheme: dark) {\n        .action-sheet {\n            background: #1f2937;\n        }\n\n        .action-sheet-title {\n            color: #f9fafb;\n        }\n\n        .action-sheet-message {\n            color: #9ca3af;\n        }\n\n        .action-sheet-action {\n            color: #f9fafb;\n        }\n\n        .action-sheet-action:active {\n            background-color: #374151;\n        }\n\n        .action-sheet-cancel {\n            background: #111827;\n        }\n\n        .action-sheet-action-cancel {\n            background: #374151;\n            color: #60a5fa;\n        }\n\n        .action-sheet-action-cancel:active {\n            background-color: #4b5563;\n        }\n    }\n",document.head.appendChild(u);const g=new class{constructor(){this.toasts=[],this.container=null,this.maxToasts=3,this.defaultDuration=3e3,this.init()}init(){document.querySelector(".toast-container")?this.container=document.querySelector(".toast-container"):(this.container=document.createElement("div"),this.container.className="toast-container",document.body.appendChild(this.container))}show(t={}){const e={id:Date.now()+Math.random(),type:t.type||"info",message:t.message||"",title:t.title||"",duration:void 0!==t.duration?t.duration:this.defaultDuration,action:t.action||null,dismissible:!1!==t.dismissible,icon:t.icon||this.getDefaultIcon(t.type||"info")};return this.toasts.length>=this.maxToasts&&this.dismiss(this.toasts[0].id),this.toasts.push(e),this.render(e),e.duration>0&&setTimeout(()=>{this.dismiss(e.id)},e.duration),window.haptic&&("error"===e.type?window.haptic.error():"success"===e.type?window.haptic.success():window.haptic.light()),e.id}getDefaultIcon(t){const e={success:"M5 13l4 4L19 7",error:"M6 18L18 6M6 6l12 12",warning:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",info:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"};return e[t]||e.info}render(t){const e=document.createElement("div");e.className=`toast toast-${t.type}`,e.dataset.toastId=t.id,e.setAttribute("role","alert"),e.setAttribute("aria-live","polite");const n={success:"text-green-500",error:"text-red-500",warning:"text-yellow-500",info:"text-blue-500"},i={success:"bg-green-50 border-green-200",error:"bg-red-50 border-red-200",warning:"bg-yellow-50 border-yellow-200",info:"bg-blue-50 border-blue-200"};if(e.innerHTML=`\n            <div class="toast-content ${i[t.type]||i.info}">\n                <div class="toast-icon ${n[t.type]||n.info}">\n                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t.icon}"></path>\n                    </svg>\n                </div>\n                <div class="toast-body">\n                    ${t.title?`<div class="toast-title">${t.title}</div>`:""}\n                    <div class="toast-message">${t.message}</div>\n                </div>\n                ${t.action?`\n                    <button class="toast-action" data-action="${t.id}">\n                        ${t.action.label}\n                    </button>\n                `:""}\n                ${t.dismissible?`\n                    <button class="toast-close" data-close="${t.id}" aria-label="Закрыть">\n                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n                        </svg>\n                    </button>\n                `:""}\n            </div>\n        `,this.container.appendChild(e),setTimeout(()=>{e.classList.add("toast-show")},10),t.action){e.querySelector("[data-action]").onclick=()=>{"function"==typeof t.action.handler&&t.action.handler(),this.dismiss(t.id)}}if(t.dismissible){e.querySelector("[data-close]").onclick=()=>{this.dismiss(t.id)}}let s=0,a=0,o=!1;e.addEventListener("touchstart",t=>{s=t.touches[0].clientX,o=!0,e.style.transition="none"}),e.addEventListener("touchmove",t=>{if(!o)return;a=t.touches[0].clientX;const n=a-s;n>0&&(e.style.transform=`translateX(${n}px)`,e.style.opacity=Math.max(0,1-n/200))}),e.addEventListener("touchend",()=>{if(!o)return;o=!1;const n=a-s;e.style.transition="",n>100?this.dismiss(t.id):(e.style.transform="",e.style.opacity=""),s=0,a=0})}dismiss(t){const e=this.container.querySelector(`[data-toast-id="${t}"]`);e&&(e.classList.remove("toast-show"),e.classList.add("toast-hide"),setTimeout(()=>{e.remove(),this.toasts=this.toasts.filter(e=>e.id!==t)},300))}success(t,e={}){return this.show({type:"success",message:t,...e})}error(t,e={}){return this.show({type:"error",message:t,duration:5e3,...e})}warning(t,e={}){return this.show({type:"warning",message:t,...e})}info(t,e={}){return this.show({type:"info",message:t,...e})}loading(t,e={}){return this.show({type:"info",message:t,duration:0,dismissible:!1,icon:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15",...e})}dismissAll(){this.toasts.forEach(t=>{this.dismiss(t.id)})}};window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.magic("toast",()=>g),Alpine.store("toast",{show:t=>g.show(t),success:(t,e)=>g.success(t,e),error:(t,e)=>g.error(t,e),warning:(t,e)=>g.warning(t,e),info:(t,e)=>g.info(t,e),loading:(t,e)=>g.loading(t,e),dismiss:t=>g.dismiss(t)})}),window.toast=g;const w=document.createElement("style");w.textContent='\n    /* Toast Container */\n    .toast-container {\n        position: fixed;\n        top: 1rem;\n        right: 1rem;\n        z-index: 9999;\n        display: flex;\n        flex-direction: column;\n        gap: 0.75rem;\n        pointer-events: none;\n        max-width: calc(100vw - 2rem);\n    }\n\n    @media (max-width: 640px) {\n        .toast-container {\n            top: auto;\n            bottom: calc(env(safe-area-inset-bottom, 0px) + 5rem);\n            left: 1rem;\n            right: 1rem;\n        }\n    }\n\n    /* Toast Base */\n    .toast {\n        pointer-events: auto;\n        transform: translateX(calc(100% + 1rem));\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        will-change: transform, opacity;\n    }\n\n    @media (max-width: 640px) {\n        .toast {\n            transform: translateY(calc(100% + 1rem));\n        }\n    }\n\n    .toast-show {\n        transform: translateX(0) !important;\n        opacity: 1 !important;\n    }\n\n    @media (max-width: 640px) {\n        .toast-show {\n            transform: translateY(0) !important;\n        }\n    }\n\n    .toast-hide {\n        transform: translateX(calc(100% + 1rem)) !important;\n        opacity: 0 !important;\n    }\n\n    @media (max-width: 640px) {\n        .toast-hide {\n            transform: translateY(calc(100% + 1rem)) !important;\n        }\n    }\n\n    /* Toast Content */\n    .toast-content {\n        display: flex;\n        align-items: flex-start;\n        gap: 0.75rem;\n        padding: 1rem;\n        background: white;\n        border: 1px solid;\n        border-radius: 0.75rem;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);\n        min-width: 300px;\n        max-width: 400px;\n    }\n\n    @media (max-width: 640px) {\n        .toast-content {\n            min-width: 0;\n            max-width: 100%;\n        }\n    }\n\n    .toast-icon {\n        flex-shrink: 0;\n        margin-top: 0.125rem;\n    }\n\n    .toast-body {\n        flex: 1;\n        min-width: 0;\n    }\n\n    .toast-title {\n        font-weight: 600;\n        font-size: 0.875rem;\n        color: #111827;\n        margin-bottom: 0.25rem;\n    }\n\n    .toast-message {\n        font-size: 0.875rem;\n        color: #4b5563;\n        line-height: 1.4;\n        word-wrap: break-word;\n    }\n\n    .toast-action {\n        flex-shrink: 0;\n        padding: 0.25rem 0.75rem;\n        font-size: 0.875rem;\n        font-weight: 600;\n        color: #2563eb;\n        background: transparent;\n        border: none;\n        border-radius: 0.375rem;\n        cursor: pointer;\n        transition: background-color 0.15s ease;\n        white-space: nowrap;\n    }\n\n    .toast-action:hover {\n        background-color: rgba(37, 99, 235, 0.1);\n    }\n\n    .toast-action:active {\n        background-color: rgba(37, 99, 235, 0.2);\n    }\n\n    .toast-close {\n        flex-shrink: 0;\n        padding: 0.25rem;\n        color: #6b7280;\n        background: transparent;\n        border: none;\n        border-radius: 0.25rem;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        line-height: 0;\n    }\n\n    .toast-close:hover {\n        color: #111827;\n        background-color: rgba(0, 0, 0, 0.05);\n    }\n\n    .toast-close:active {\n        background-color: rgba(0, 0, 0, 0.1);\n    }\n\n    /* Success */\n    .toast-success .toast-title {\n        color: #065f46;\n    }\n\n    .toast-success .toast-message {\n        color: #047857;\n    }\n\n    /* Error */\n    .toast-error .toast-title {\n        color: #991b1b;\n    }\n\n    .toast-error .toast-message {\n        color: #dc2626;\n    }\n\n    /* Warning */\n    .toast-warning .toast-title {\n        color: #92400e;\n    }\n\n    .toast-warning .toast-message {\n        color: #d97706;\n    }\n\n    /* Info */\n    .toast-info .toast-title {\n        color: #1e40af;\n    }\n\n    .toast-info .toast-message {\n        color: #2563eb;\n    }\n\n    /* Dark mode support */\n    @media (prefers-color-scheme: dark) {\n        .toast-content {\n            background: #1f2937;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);\n        }\n\n        .toast-title {\n            color: #f9fafb;\n        }\n\n        .toast-message {\n            color: #d1d5db;\n        }\n\n        .toast-close {\n            color: #9ca3af;\n        }\n\n        .toast-close:hover {\n            color: #f9fafb;\n            background-color: rgba(255, 255, 255, 0.1);\n        }\n\n        .bg-green-50 {\n            background: rgba(16, 185, 129, 0.1) !important;\n        }\n\n        .bg-red-50 {\n            background: rgba(239, 68, 68, 0.1) !important;\n        }\n\n        .bg-yellow-50 {\n            background: rgba(245, 158, 11, 0.1) !important;\n        }\n\n        .bg-blue-50 {\n            background: rgba(59, 130, 246, 0.1) !important;\n        }\n\n        .border-green-200 {\n            border-color: rgba(16, 185, 129, 0.3) !important;\n        }\n\n        .border-red-200 {\n            border-color: rgba(239, 68, 68, 0.3) !important;\n        }\n\n        .border-yellow-200 {\n            border-color: rgba(245, 158, 11, 0.3) !important;\n        }\n\n        .border-blue-200 {\n            border-color: rgba(59, 130, 246, 0.3) !important;\n        }\n\n        .toast-success .toast-message {\n            color: #34d399;\n        }\n\n        .toast-error .toast-message {\n            color: #f87171;\n        }\n\n        .toast-warning .toast-message {\n            color: #fbbf24;\n        }\n\n        .toast-info .toast-message {\n            color: #60a5fa;\n        }\n    }\n\n    /* Reduce motion */\n    @media (prefers-reduced-motion: reduce) {\n        .toast {\n            transition: none !important;\n        }\n    }\n\n    /* Loading spinner animation */\n    @keyframes spin {\n        to {\n            transform: rotate(360deg);\n        }\n    }\n\n    .toast [d*="M4 4v5h.582"] {\n        animation: spin 1s linear infinite;\n        transform-origin: center;\n    }\n',document.head.appendChild(w);const f={inbox:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4",search:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",box:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4",chat:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",users:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z",document:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",photo:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z",calendar:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",clipboard:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2",bell:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9",chart:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z",shopping:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z",tag:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z","wifi-off":"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3l8.293 8.293",error:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"};const v=new class{constructor(){this.activeStates=new WeakMap}show(t,e={}){const n="string"==typeof t?document.querySelector(t):t;if(!n)return;const i={icon:e.icon||"inbox",title:e.title||"Пусто",message:e.message||"Здесь пока ничего нет",actionText:e.actionText||"Добавить",action:e.action||null,compact:e.compact||!1,replace:!1!==e.replace},s=this.create(i);return i.replace?(n.innerHTML="",n.appendChild(s)):n.appendChild(s),this.activeStates.set(n,s),s}hide(t){const e="string"==typeof t?document.querySelector(t):t;if(!e)return;const n=this.activeStates.get(e);n&&n.parentNode&&(n.remove(),this.activeStates.delete(e))}create(t){const e=document.createElement("div");e.className=`empty-state flex flex-col items-center justify-center text-center ${t.compact?"py-8":"py-16"} px-6`,e.setAttribute("data-empty-state","true");const n=t.compact?"w-16 h-16":"w-24 h-24",i=f[t.icon]||f.inbox;if(e.innerHTML=`\n            <div class="mb-6 ${n} text-gray-300 dark:text-gray-600">\n                <svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="${i}"></path>\n                </svg>\n            </div>\n            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">\n                ${t.title}\n            </h3>\n            <p class="text-sm text-gray-600 dark:text-gray-400 mb-6 max-w-sm">\n                ${t.message}\n            </p>\n            ${t.action?`\n                <button\n                    class="empty-state-action inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 active:bg-blue-800 transition-colors"\n                    data-haptic="light">\n                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>\n                    </svg>\n                    <span>${t.actionText}</span>\n                </button>\n            `:""}\n        `,t.action){e.querySelector(".empty-state-action").addEventListener("click",()=>{"function"==typeof t.action?t.action():"string"==typeof t.action&&(window.location.href=t.action),window.haptic&&window.haptic.light()})}return e}toggle(t,e,n={}){e?this.show(t,n):this.hide(t)}};window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.directive("empty-state",(t,{expression:e},{evaluateLater:n,cleanup:i})=>{const s=n(e),a=()=>{s(e=>{e&&e.show?v.show(t,e):v.hide(t)})};a();const o=new MutationObserver(()=>{0!==t.children.length||t.dataset.emptyStateManual||a()});o.observe(t,{childList:!0}),i(()=>{o.disconnect(),v.hide(t)})}),Alpine.magic("emptyState",()=>v),Alpine.store("emptyState",{show:(t,e)=>v.show(t,e),hide:t=>v.hide(t),toggle:(t,e,n)=>v.toggle(t,e,n)})}),window.emptyState=v;const b=new class{constructor(){this.supported=this.isSupported(),this.init()}init(){this.supported}isSupported(){return"share"in navigator}canShare(t={}){if(!this.supported)return!1;try{return!navigator.canShare||navigator.canShare(t)}catch(e){return!1}}async share(t={}){const e={title:t.title||document.title,text:t.text||"",url:t.url||window.location.href};if(t.files&&Array.isArray(t.files)&&t.files.length>0&&(e.files=t.files),!this.canShare(e))return this.fallbackShare(e);try{return await navigator.share(e),window.haptic&&window.haptic.success(),window.toast&&window.toast.success("Успешно отправлено"),{success:!0}}catch(n){return"AbortError"===n.name?{success:!1,cancelled:!0}:(window.haptic&&window.haptic.error(),this.fallbackShare(e))}}async fallbackShare(t){const e=t.url||window.location.href,n=t.text?`${t.text}\n\n`:"",i=`${t.title?`${t.title}\n`:""}${n}${e}`;try{return await navigator.clipboard.writeText(i),window.toast&&window.toast.success("Ссылка скопирована в буфер обмена",{action:{label:"Понятно",handler:()=>{}}}),window.haptic&&window.haptic.success(),{success:!0,fallback:!0}}catch(s){return window.toast&&window.toast.info("Скопируйте ссылку вручную",{duration:0,action:{label:"Закрыть",handler:()=>{}}}),{success:!1,error:s}}}async shareProduct(t){const e=t.url||`${window.location.origin}/products/${t.id}`;return this.share({title:t.name||t.title||"Товар",text:t.description||"Посмотрите этот товар!",url:e})}async shareOrder(t){const e=t.url||`${window.location.origin}/orders/${t.id}`;return this.share({title:`Заказ #${t.id||t.number}`,text:t.description||"Информация о заказе",url:e})}async shareDialog(t){const e=t.url||`${window.location.origin}/dialogs/${t.id}`;return this.share({title:t.title||"Диалог",text:t.summary||"Поделиться диалогом",url:e})}async sharePage(t={}){return this.share({title:t.title||document.title,text:t.text||"",url:t.url||window.location.href})}async shareImage(t,e={}){if(!t)return{success:!1,error:"No image"};let n=t;return!(t instanceof File)&&t instanceof Blob&&(n=new File([t],e.filename||"image.png",{type:t.type||"image/png"})),this.share({title:e.title||"Изображение",text:e.text||"",files:[n]})}shareVia(t,e){const n=e.url||window.location.href,i=encodeURIComponent(e.text||""),s=encodeURIComponent(e.title||""),a={telegram:`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${i}`,whatsapp:`https://wa.me/?text=${i}%20${encodeURIComponent(n)}`,twitter:`https://twitter.com/intent/tweet?url=${encodeURIComponent(n)}&text=${i}`,facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`,vk:`https://vk.com/share.php?url=${encodeURIComponent(n)}&title=${s}`,email:`mailto:?subject=${s}&body=${i}%20${encodeURIComponent(n)}`,copy:null};if("copy"===t){const t=`${e.title?e.title+"\n":""}${e.text?e.text+"\n\n":""}${n}`;return navigator.clipboard.writeText(t)}const o=a[t];return o?(window.open(o,"_blank","noopener,noreferrer"),Promise.resolve({success:!0,service:t})):Promise.reject({success:!1,error:"Unknown service"})}};window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.magic("share",()=>b),Alpine.store("share",{supported:b.supported,share:t=>b.share(t),shareProduct:t=>b.shareProduct(t),shareOrder:t=>b.shareOrder(t),shareDialog:t=>b.shareDialog(t),sharePage:t=>b.sharePage(t),shareImage:(t,e)=>b.shareImage(t,e),shareVia:(t,e)=>b.shareVia(t,e)}),Alpine.directive("share",(t,{expression:e,modifiers:n},{evaluate:i})=>{t.addEventListener("click",async()=>{const t=e?i(e):{};window.haptic&&window.haptic.light(),n.includes("product")&&t?await b.shareProduct(t):n.includes("order")&&t?await b.shareOrder(t):n.includes("dialog")&&t?await b.shareDialog(t):n.includes("page")?await b.sharePage(t):await b.share(t)})})}),window.share=b;class y{constructor(t,e={}){this.element=t,this.options={threshold:80,maxSwipe:200,leftActions:e.leftActions||[],rightActions:e.rightActions||[],enabled:!0,...e},this.touchStartX=0,this.touchCurrentX=0,this.isSwiping=!1,this.swipeDistance=0,this.actionsRevealed=null,this.createActionElements(),this.attachListeners()}createActionElements(){const t=this.element.innerHTML;this.element.innerHTML="",this.element.classList.add("swipe-actions-container"),this.wrapper=document.createElement("div"),this.wrapper.className="swipe-actions-wrapper",this.contentEl=document.createElement("div"),this.contentEl.className="swipe-actions-content",this.contentEl.innerHTML=t,this.options.leftActions.length>0&&(this.leftActionsEl=this.createActionsElement(this.options.leftActions,"left"),this.wrapper.appendChild(this.leftActionsEl)),this.options.rightActions.length>0&&(this.rightActionsEl=this.createActionsElement(this.options.rightActions,"right")),this.wrapper.appendChild(this.contentEl),this.rightActionsEl&&this.wrapper.appendChild(this.rightActionsEl),this.element.appendChild(this.wrapper)}createActionsElement(t,e){const n=document.createElement("div");return n.className=`swipe-actions-${e}`,t.forEach(t=>{const e=document.createElement("button");e.className="swipe-action "+(t.destructive?"swipe-action-destructive":""),e.style.backgroundColor=t.color||(t.destructive?"#ef4444":"#3b82f6"),e.dataset.actionId=t.id||t.label,t.icon?e.innerHTML=`\n                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t.icon}"></path>\n                    </svg>\n                    <span class="text-xs mt-1">${t.label}</span>\n                `:e.innerHTML=`<span>${t.label}</span>`,e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.handleAction(t)}),n.appendChild(e)}),n}attachListeners(){this.contentEl.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.contentEl.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.contentEl.addEventListener("touchend",this.onTouchEnd.bind(this),{passive:!0}),document.addEventListener("click",t=>{this.actionsRevealed&&!this.element.contains(t.target)&&this.reset()})}onTouchStart(t){this.options.enabled&&(this.touchStartX=t.touches[0].clientX,this.isSwiping=!1,this.contentEl.style.transition="none")}onTouchMove(t){if(!this.options.enabled)return;this.touchCurrentX=t.touches[0].clientX;const e=this.touchCurrentX-this.touchStartX;if(Math.abs(e)>10){this.isSwiping=!0,t.preventDefault();const n=3;this.swipeDistance=e/n;const i=this.options.maxSwipe/n;this.swipeDistance=Math.max(-i,Math.min(i,this.swipeDistance)),this.swipeDistance>0&&!this.leftActionsEl&&(this.swipeDistance=0),this.swipeDistance<0&&!this.rightActionsEl&&(this.swipeDistance=0),this.contentEl.style.transform=`translateX(${this.swipeDistance}px)`,this.swipeDistance>0&&this.leftActionsEl&&(this.leftActionsEl.style.opacity=Math.min(1,Math.abs(this.swipeDistance)/40)),this.swipeDistance<0&&this.rightActionsEl&&(this.rightActionsEl.style.opacity=Math.min(1,Math.abs(this.swipeDistance)/40))}}onTouchEnd(){if(!this.isSwiping)return void this.reset();this.contentEl.style.transition="transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)";const t=this.options.threshold/3;Math.abs(this.swipeDistance)>=t?this.swipeDistance>0&&this.leftActionsEl?this.revealActions("left"):this.swipeDistance<0&&this.rightActionsEl?this.revealActions("right"):this.reset():this.reset(),this.isSwiping=!1}revealActions(t){const e="left"===t?80:-80;this.contentEl.style.transform=`translateX(${e}px)`,this.actionsRevealed=t,"left"===t&&this.leftActionsEl&&(this.leftActionsEl.style.opacity="1"),"right"===t&&this.rightActionsEl&&(this.rightActionsEl.style.opacity="1"),window.haptic&&window.haptic.light()}reset(){this.contentEl.style.transition="transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",this.contentEl.style.transform="translateX(0)",this.swipeDistance=0,this.actionsRevealed=null,this.leftActionsEl&&(this.leftActionsEl.style.opacity="0"),this.rightActionsEl&&(this.rightActionsEl.style.opacity="0")}handleAction(t){window.haptic&&(t.destructive?window.haptic.medium():window.haptic.light()),"function"==typeof t.handler&&t.handler(this.element),this.reset()}enable(){this.options.enabled=!0}disable(){this.options.enabled=!1,this.reset()}destroy(){this.reset(),this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}}window.Alpine&&document.addEventListener("alpine:init",()=>{Alpine.directive("swipe-actions",(t,{expression:e},{evaluate:n,cleanup:i})=>{const s=e?n(e):{},a=new y(t,s);i(()=>{a.destroy()})}),Alpine.magic("swipeActions",()=>({create:(t,e)=>new y(t,e)}))}),window.SwipeActions=y;const x=document.createElement("style");x.textContent="\n    /* Swipe Actions Container */\n    .swipe-actions-container {\n        position: relative;\n        overflow: hidden;\n        touch-action: pan-y;\n    }\n\n    .swipe-actions-wrapper {\n        position: relative;\n        display: flex;\n        align-items: stretch;\n    }\n\n    .swipe-actions-content {\n        position: relative;\n        flex: 1;\n        background: white;\n        z-index: 2;\n        width: 100%;\n        will-change: transform;\n    }\n\n    .swipe-actions-left,\n    .swipe-actions-right {\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        display: flex;\n        align-items: stretch;\n        z-index: 1;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n    }\n\n    .swipe-actions-left {\n        left: 0;\n        flex-direction: row;\n    }\n\n    .swipe-actions-right {\n        right: 0;\n        flex-direction: row-reverse;\n    }\n\n    .swipe-action {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        min-width: 80px;\n        padding: 0 1rem;\n        color: white;\n        font-weight: 600;\n        font-size: 0.875rem;\n        border: none;\n        cursor: pointer;\n        transition: opacity 0.2s ease;\n        -webkit-tap-highlight-color: transparent;\n    }\n\n    .swipe-action:active {\n        opacity: 0.8;\n    }\n\n    .swipe-action-destructive {\n        background-color: #ef4444;\n    }\n\n    .swipe-action svg {\n        margin-bottom: 0.25rem;\n    }\n\n    /* Dark mode support */\n    @media (prefers-color-scheme: dark) {\n        .swipe-actions-content {\n            background: #1f2937;\n        }\n    }\n\n    /* Prevent text selection during swipe */\n    .swipe-actions-container.swiping {\n        user-select: none;\n        -webkit-user-select: none;\n    }\n",document.head.appendChild(x);const k=t.create({baseURL:"/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});k.interceptors.request.use(t=>{let e=localStorage.getItem("_x_auth_token");if(e)try{e=JSON.parse(e)}catch(n){}return e||(e=localStorage.getItem("auth_token")),e&&(t.headers.Authorization=`Bearer ${e}`),t}),k.interceptors.response.use(t=>t,t=>(401===t.response?.status&&(localStorage.removeItem("_x_auth_token"),localStorage.removeItem("_x_auth_user"),localStorage.removeItem("_x_current_company"),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),window.location.pathname.includes("/login")||(window.location.href="/login")),Promise.reject(t)));const E={register:async t=>(await k.post("/auth/register",t)).data,login:async(t,e)=>(await k.post("/auth/login",{email:t,password:e})).data,async logout(){try{await k.post("/auth/logout")}catch(t){}localStorage.removeItem("_x_auth_token"),localStorage.removeItem("_x_auth_user"),localStorage.removeItem("_x_current_company"),localStorage.removeItem("auth_token"),localStorage.removeItem("user")},me:async()=>(await k.get("/me")).data,getUser(){const t=localStorage.getItem("user");return t?JSON.parse(t):null},isAuthenticated:()=>!!localStorage.getItem("auth_token")},S={list:async()=>(await k.get("/companies")).data.companies,create:async t=>(await k.post("/companies",t)).data.company},A={list:async(t,e={})=>(await k.get("/products",{params:{company_id:t,...e}})).data,get:async t=>(await k.get(`/products/${t}`)).data.product,create:async t=>(await k.post("/products",t)).data.product,update:async(t,e)=>(await k.put(`/products/${t}`,e)).data.product,async delete(t){await k.delete(`/products/${t}`)}},C={list:async(t,e={})=>(await k.get("/dialogs",{params:{company_id:t,...e}})).data,get:async t=>(await k.get(`/dialogs/${t}`)).data.dialog,create:async(t,e=null,n="general",i=!1)=>(await k.post("/dialogs",{company_id:t,title:e,category:n,is_private:i})).data.dialog,hide:async t=>(await k.post(`/dialogs/${t}/hide`)).data},M={send:async t=>(await k.post("/chat",t)).data,generateCard:async t=>(await k.post("/chat/generate-card",t)).data.card,generateReviewResponse:async t=>(await k.post("/chat/generate-review-response",t)).data.responses},L={async upload(t,e,n=!1){const i=new FormData;i.append("image",e),i.append("is_primary",n);return(await k.post(`/products/${t}/images/upload`,i,{headers:{"Content-Type":"multipart/form-data"}})).data.image},generate:async(t,e,n="medium",i=1)=>(await k.post(`/products/${t}/images/generate`,{prompt:e,quality:n,count:i})).data.images},$={list:async(t,e={})=>(await k.get("/agent/tasks",{params:{company_id:t,...e}})).data,get:async t=>(await k.get(`/agent/tasks/${t}`)).data.task,create:async(t,e,n)=>(await k.post("/agent/tasks",{company_id:t,type:e,input_data:n})).data.task};function T(t,n){try{return e.$persist(t).as(n)}catch(i){return localStorage.removeItem("_x_"+n),localStorage.removeItem(n),t}}e.plugin(n);try{["auth_user","auth_token","current_company"].forEach(t=>{const e="_x_"+t,n=localStorage.getItem(e);if(n)try{JSON.parse(n)}catch(i){localStorage.removeItem(e),localStorage.removeItem(t)}})}catch(I){}window.api={...k,auth:E,companies:S,products:A,dialogs:C,chat:M,images:L,tasks:$,get:k.get,post:k.post,delete:k.delete},e.store("auth",{user:T(null,"auth_user"),token:T(null,"auth_token"),currentCompany:T(null,"current_company"),companies:[],showCompanyPrompt:!1,get isAuthenticated(){return!!this.token},get hasCompanies(){return this.companies.length>0},async login(t,e){const n=await E.login(t,e);return this.user=n.user,this.token=n.token,await this.loadCompanies(),n},async register(t){const e=await E.register(t);return this.user=e.user,this.token=e.token,await this.loadCompanies(),e},async loadCompanies(){try{if(this.companies=await S.list(),this.companies.length>0){if(!(this.currentCompany&&this.companies.some(t=>t.id===this.currentCompany.id))){const t=this.user?.company_id,e=t?this.companies.find(e=>e.id===t):null;this.currentCompany=e||this.companies[0]}this.showCompanyPrompt=!1}else this.showCompanyPrompt=!0,this.currentCompany=null;this.currentCompany&&await e.store("chat").loadDialogs(this.currentCompany.id)}catch(I){}},async logout(){await E.logout(),this.user=null,this.token=null,this.currentCompany=null,this.companies=[]},setCompany(t){this.currentCompany=t,t&&e.store("chat").loadDialogs(t.id)}}),e.store("chat",{dialogs:[],currentDialog:null,messages:[],loading:!1,async loadDialogs(t){try{const e=await C.list(t);this.dialogs=e.dialogs||[]}catch(I){this.dialogs=[]}},async loadDialog(t){this.loading=!0;const e=await C.get(t);this.currentDialog=e,this.messages=e.messages||[],this.loading=!1},async sendMessage(t,n={}){this.loading=!0;const i={message:t,mode:n.mode||"chat",model:n.model||"fast"};if(n.image_model&&(i.image_model=n.image_model),n.is_private&&(i.is_private=!0),this.currentDialog)i.dialog_id=this.currentDialog.id;else{const t=e.store("auth");i.company_id=t.currentCompany?.id}n.images?.length&&(i.images=n.images);const s={id:"temp-"+Date.now(),sender:"user",content:t,created_at:(new Date).toISOString()};this.messages.push(s);try{const t=await M.send(i);if(this.currentDialog){const e=this.dialogs.findIndex(e=>e.id===t.dialog.id);-1!==e&&(this.dialogs[e]=t.dialog)}else this.currentDialog=t.dialog,this.dialogs.unshift(t.dialog);const e=this.messages.findIndex(t=>t.id===s.id);return-1!==e&&(this.messages[e]=t.user_message),this.messages.push(t.assistant_message),this.loading=!1,t}catch(a){throw this.messages=this.messages.filter(t=>t.id!==s.id),this.loading=!1,a}},newChat(){this.currentDialog=null,this.messages=[]}}),e.store("products",{items:[],current:null,loading:!1,meta:{},async load(t,e={}){this.loading=!0;const n=await A.list(t,e);this.items=n.products,this.meta=n.meta,this.loading=!1},async get(t){return this.loading=!0,this.current=await A.get(t),this.loading=!1,this.current},async create(t){const e=await A.create(t);return this.items.unshift(e),e}}),e.store("pwa",{isInstalled:window.isPWAInstalled||!1,get canInstall(){return"BeforeInstallPromptEvent"in window},checkStatus(){return this.isInstalled=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://"),this.isInstalled}}),window.Alpine=e,e.start();
