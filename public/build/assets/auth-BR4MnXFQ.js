window.SmAuth=new class{constructor(){this.PIN_KEY="sm_pin_hash",this.TOKEN_KEY="sm_auth_token",this.BIOMETRIC_KEY="sm_biometric_enabled"}async isBiometricAvailable(){if(!window.PublicKeyCredential)return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch{return!1}}async hashPin(t){const e=(new TextEncoder).encode(t+"sm_salt_2024"),i=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map(t=>t.toString(16).padStart(2,"0")).join("")}async setPin(t){const e=await this.hashPin(t);return localStorage.setItem(this.PIN_KEY,e),!0}async verifyPin(t){const e=localStorage.getItem(this.PIN_KEY);if(!e)return!1;return await this.hashPin(t)===e}hasPinSet(){return!!localStorage.getItem(this.PIN_KEY)}enableBiometric(t){localStorage.setItem(this.BIOMETRIC_KEY,"true"),localStorage.setItem(this.TOKEN_KEY,t)}isBiometricEnabled(){return"true"===localStorage.getItem(this.BIOMETRIC_KEY)}async authenticateWithBiometric(){if(!this.isBiometricEnabled())throw new Error("Biometric not enabled");try{if(await navigator.credentials.get({publicKey:{challenge:new Uint8Array(32),timeout:6e4,userVerification:"required",rpId:window.location.hostname}}))return localStorage.getItem(this.TOKEN_KEY)}catch(t){throw t}}logout(){localStorage.removeItem(this.PIN_KEY),localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.BIOMETRIC_KEY)}};
