# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ SellerMind

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∑–∞–ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ø–ª–∞—Ç–µ–∂–µ–π.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
3. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–ø–ª–∞—Ç–µ–∂–Ω—ã—Ö-—Å–∏—Å—Ç–µ–º)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
5. [–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á](#–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫-–∑–∞–¥–∞—á)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ –≤–∫–ª—é—á–∞–µ—Ç:
- ‚úÖ **4 —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–∞**: –°—Ç–∞—Ä—Ç, –ë–∏–∑–Ω–µ—Å, –ü—Ä–æ, Enterprise
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤, —Å–∫–ª–∞–¥–æ–≤, –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: Email, Telegram, Database –∑–∞ 7/3/1 –¥–µ–Ω—å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ‚úÖ **–ü–ª–∞—Ç–µ–∂–∏**: Click, Payme (–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω)
- ‚úÖ **API**: –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ —á–µ—Ä–µ–∑ REST API

---

## üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ
php artisan migrate --force
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã:
- `plans` - —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã
- `subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π

### 2. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤

```bash
php artisan db:seed --class=PlanSeeder
```

–°–æ–∑–¥–∞—Å—Ç 4 —Ç–∞—Ä–∏—Ñ–∞:
- **–°—Ç–∞—Ä—Ç**: 500,000 UZS/–º–µ—Å
- **–ë–∏–∑–Ω–µ—Å**: 1,500,000 UZS/–º–µ—Å (–ø–æ–ø—É–ª—è—Ä–Ω—ã–π)
- **–ü—Ä–æ**: 3,500,000 UZS/–º–µ—Å
- **Enterprise**: 7,000,000 UZS/–º–µ—Å

---

## üí≥ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

### 1. Click

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
CLICK_MERCHANT_ID=your_merchant_id
CLICK_SERVICE_ID=your_service_id
CLICK_SECRET_KEY=your_secret_key
CLICK_MERCHANT_USER_ID=your_user_id
```

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è webhook URLs –≤ Click:**
- Prepare: `https://sellermind.uz/webhooks/click/prepare`
- Complete: `https://sellermind.uz/webhooks/click/complete`

### 2. Payme (Paycom)

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
PAYME_MERCHANT_ID=your_merchant_id
PAYME_SECRET_KEY=your_secret_key
PAYME_ENDPOINT=https://checkout.paycom.uz
```

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è webhook URL –≤ Payme:**
- Endpoint: `https://sellermind.uz/webhooks/payme`
- Method: JSON-RPC 2.0
- Authorization: HTTP Basic Auth (Paycom:{SECRET_KEY})

---

## üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `config/mail.php`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP:

```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@sellermind.uz
MAIL_FROM_NAME="SellerMind AI"
```

### 2. Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–£–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç Telegram –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è:
- –ë–æ—Ç: `@your_bot_username`
- –ö–æ–º–∞–Ω–¥–∞: `/link CODE`

### 3. Database —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `notifications`. –î–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑:
```php
$user->notifications
$user->unreadNotifications
```

---

## ‚è∞ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cron

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
* * * * * cd /path-to-sellermind && php artisan schedule:run >> /dev/null 2>&1
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á

–°–ø–∏—Å–æ–∫ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á:
```bash
php artisan schedule:list
```

### 3. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–µ–∫–∞—é—â–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–∑–∞ 7, 3, 1 –¥–µ–Ω—å)
php artisan subscriptions:check-expiring

# –° –ø–æ–º–µ—Ç–∫–æ–π –∏—Å—Ç–µ–∫—à–∏—Ö
php artisan subscriptions:check-expiring --mark-expired

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–Ω–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
php artisan subscriptions:check-expiring --notify-days=14,7,3,1
```

### 4. –õ–æ–≥–∏

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏:
```bash
tail -f storage/logs/subscriptions.log
tail -f storage/logs/laravel.log
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

#### –ü–æ–ª—É—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã
```bash
curl https://sellermind.uz/api/plans
```

#### –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
     https://sellermind.uz/api/subscription/status
```

#### –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
```bash
curl -X POST \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"plan_id": 2, "billing_period": "monthly"}' \
     https://sellermind.uz/api/subscription/subscribe
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π

#### Click (Sandbox)
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/payment/subscription/{id}`
2. –í—ã–±–µ—Ä–∏—Ç–µ Click
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Click

#### Payme (Sandbox)
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/payment/subscription/{id}`
2. –í—ã–±–µ—Ä–∏—Ç–µ Payme
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Payme

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É, –∏—Å—Ç–µ–∫–∞—é—â—É—é –∑–∞–≤—Ç—Ä–∞
php artisan tinker

$subscription = Subscription::create([
    'company_id' => 1,
    'plan_id' => 2,
    'status' => 'active',
    'starts_at' => now(),
    'ends_at' => now()->addDay(),
]);

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
php artisan subscriptions:check-expiring --notify-days=1
```

---

## üîß Middleware –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ middleware

Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫:
- `POST /api/products` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç —Ç–æ–≤–∞—Ä–æ–≤
- `POST /api/marketplace/accounts` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- `POST /api/companies/{id}/members` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `POST /api/warehouses` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç —Å–∫–ª–∞–¥–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤ –∫ –Ω–æ–≤—ã–º –º–∞—Ä—à—Ä—É—Ç–∞–º

```php
Route::post('/some-entity', [Controller::class, 'store'])
    ->middleware('plan.limits:entity_type,count');

// –ü—Ä–∏–º–µ—Ä—ã:
->middleware('plan.limits:products,1')      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç —Ç–æ–≤–∞—Ä–æ–≤
->middleware('plan.limits:users,5')         // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
->middleware('plan.limits:marketplace_accounts,1')
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫

```sql
-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
SELECT c.name, p.name, s.ends_at, s.status
FROM subscriptions s
JOIN companies c ON s.company_id = c.id
JOIN plans p ON s.plan_id = p.id
WHERE s.status = 'active';

-- –ò—Å—Ç–µ–∫–∞—é—â–∏–µ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π
SELECT c.name, p.name, DATEDIFF(s.ends_at, NOW()) as days_left
FROM subscriptions s
JOIN companies c ON s.company_id = c.id
JOIN plans p ON s.plan_id = p.id
WHERE s.status = 'active'
  AND s.ends_at BETWEEN NOW() AND DATE_ADD(NOW(), INTERVAL 7 DAY);

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
SELECT
    c.name,
    s.current_products_count,
    p.max_products,
    ROUND(s.current_products_count / p.max_products * 100, 1) as usage_pct
FROM subscriptions s
JOIN companies c ON s.company_id = c.id
JOIN plans p ON s.plan_id = p.id
WHERE s.status = 'active';
```

---

## üöÄ –î–µ–ø–ª–æ–π checklist

- [ ] –ó–∞–ø—É—â–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ (`php artisan migrate --force`)
- [ ] –ó–∞–≥—Ä—É–∂–µ–Ω—ã —Ç–∞—Ä–∏—Ñ—ã (`php artisan db:seed --class=PlanSeeder`)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Click/Payme
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã webhook URLs –≤ Click
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω webhook URL –≤ Payme
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω cron –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–ª–∞—Ç–µ–∂–∏ –≤ sandbox
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `storage/logs/subscriptions.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Laravel log: `storage/logs/laravel.log`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron: `grep CRON /var/log/syslog`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook –ª–æ–≥–∏ –≤ Click/Payme –ø–∞–Ω–µ–ª—è—Ö

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Click –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://docs.click.uz/
- **Payme –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://developer.help.paycom.uz/
- **Laravel Scheduler**: https://laravel.com/docs/scheduling
- **Laravel Notifications**: https://laravel.com/docs/notifications
