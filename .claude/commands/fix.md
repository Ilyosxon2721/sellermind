# /fix - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞

–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ —Å regression —Ç–µ—Å—Ç–æ–º.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```
/fix <–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã>
```

## –ü—Ä–∏–º–µ—Ä—ã

```
/fix –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å WB –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π 429
/fix –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
/fix –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞
```

---

## Workflow

### –§–∞–∑–∞ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ üîç
```
‚ñ° –ü–æ–Ω—è—Ç—å —Å–∏–º–ø—Ç–æ–º—ã –ø—Ä–æ–±–ª–µ–º—ã
‚ñ° –ù–∞–π—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ–¥
‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: storage/logs/laravel.log
‚ñ° –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
‚ñ° –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å root cause
```

**–í—ã–≤–æ–¥:**
```
üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
–ü—Ä–æ–±–ª–µ–º–∞: [–æ–ø–∏—Å–∞–Ω–∏–µ]
–ü—Ä–∏—á–∏–Ω–∞: [root cause]
–§–∞–π–ª—ã: [—Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤]
```

### –§–∞–∑–∞ 2: –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ üß™
```
‚ñ° –°–ù–ê–ß–ê–õ–ê –Ω–∞–ø–∏—à–∏ —Ç–µ—Å—Ç –∫–æ—Ç–æ—Ä—ã–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –±–∞–≥
‚ñ° –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ü–ê–î–ê–¢–¨ –Ω–∞ —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ
‚ñ° –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –º—ã —á–∏–Ω–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É
```

```php
/** @test */
public function test_sync_handles_rate_limit_error(): void
{
    // Arrange: –∏–º–∏—Ç–∏—Ä—É–µ–º 429 –æ—à–∏–±–∫—É
    Http::fake([
        'api.wildberries.ru/*' => Http::response([], 429)
    ]);

    // Act & Assert: –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å gracefully
    $this->expectException(RateLimitException::class);
    $service->sync();
}
```

### –§–∞–∑–∞ 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ üîß
```
‚ñ° –í–Ω–µ—Å–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
‚ñ° –ù–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏ –ª–∏—à–Ω–µ–≥–æ (–æ–¥–∏–Ω –±–∞–≥ = –æ–¥–∏–Ω —Ñ–∏–∫—Å)
‚ñ° –°–æ—Ö—Ä–∞–Ω–∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
```

### –§–∞–∑–∞ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚úÖ
```
‚ñ° –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç ‚Äî —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –ü–†–û–•–û–î–ò–¢–¨
‚ñ° –ó–∞–ø—É—Å—Ç–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã ‚Äî –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–ª–æ–º–∞—Ç—å—Å—è
‚ñ° –ü—Ä–æ–≤–µ—Ä—å –≤—Ä—É—á–Ω—É—é –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
```

### –§–∞–∑–∞ 5: –ö–æ–º–º–∏—Ç üìù
```
‚ñ° git add -A
‚ñ° git commit -m "fix(<scope>): <description>"
‚ñ° –î–æ–±–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥ –æ–±—ä—è—Å–Ω—è—é—â–∏–π —Ñ–∏–∫—Å
```

---

## –ü—Ä–∞–≤–∏–ª–∞

1. **–°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç** ‚Äî —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å –¥–æ —Ñ–∏–∫—Å–∞
2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** ‚Äî –Ω–µ —á–∏–Ω–∏ —Ç–æ —á—Ç–æ –Ω–µ —Å–ª–æ–º–∞–Ω–æ
3. **–û–¥–∏–Ω –±–∞–≥ = –æ–¥–∏–Ω –∫–æ–º–º–∏—Ç** ‚Äî –Ω–µ —Å–º–µ—à–∏–≤–∞–π —Ñ–∏–∫—Å—ã
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π** ‚Äî –¥–æ–±–∞–≤—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ—á–µ–º—É —Ç–∞–∫

---

## –§–æ—Ä–º–∞—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –≤ –∫–æ–¥–µ

```php
// FIX(#001): –î–æ–±–∞–≤–ª–µ–Ω retry –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ rate limit
// Wildberries –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429 –ø—Ä–∏ > 100 –∑–∞–ø—Ä–æ—Å–∞—Ö/–º–∏–Ω
// –†–µ—à–µ–Ω–∏–µ: exponential backoff —Å –º–∞–∫—Å. 3 –ø–æ–ø—ã—Ç–∫–∞–º–∏
return retry(3, function () {
    return $this->makeRequest();
}, function ($attempt) {
    return $attempt * 1000; // 1s, 2s, 3s
});
```

---

## –í—ã–≤–æ–¥

```
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: <–æ–ø–∏—Å–∞–Ω–∏–µ –±–∞–≥–∞>

üîç –ü—Ä–∏—á–∏–Ω–∞: <root cause>

üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
  - app/Services/WildberriesService.php

üß™ Regression —Ç–µ—Å—Ç: test_sync_handles_rate_limit_error

üìù –ö–æ–º–º–∏—Ç: fix(sync): –æ–±—Ä–∞–±–æ—Ç–∫–∞ rate limit –æ—à–∏–±–∫–∏ WB (abc1234)
```
